<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecipeHub - Plateforme culinaire premium</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Aleo:ital,wght@0,100..900;1,100..900&family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap');

        /* ===================== */
        /* VARIABLES ET RESET CSS */
        /* ===================== */
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --accent-color: #45b7d1;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --white: #ffffff;
            --gray: #95a5a6;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --premium-color: #f1c40f;
            --background-dark: #1a1a2e;
            --card-dark: #16213e;
            --text-dark: #e6e6e6;

            --gradient-primary: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --gradient-secondary: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            --gradient-accent: linear-gradient(135deg, #45b7d1 0%, #3498db 100%);
            --gradient-premium: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);

            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);

            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
            min-height: 100vh;
            background-attachment: fixed;
            transition: var(--transition);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            height: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ================= */
        /* STRUCTURE GLOBALE */
        /* ================= */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-light);
            position:relative;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .dark-mode .header {
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
        }

        .navbar {
            display: flex;
            
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            
            gap: 0.5rem;
        }

         .nav-menu {
            display: flex;
            list-style: none;
            gap: 1.3rem;
            align-items: center;
            flex-wrap:nowrap;
        }

        .nav-link {
            text-decoration: none;
            color: var(--dark-color);
            font-weight:300 ;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.5rem;
            border-radius: var(--border-radius);
        }


         .theme-toggle {
                position: absolute;
                top: 77px;
                right: 90px;
            }
        .dark-mode .nav-link {
            color: var(--text-dark);
        }

        .nav-link:hover {
            color: var(--primary-color);
            background: rgba(255, 107, 107, 0.1);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: var(--transition);
        }

        .nav-link:hover::after {
            width: 80%;
        }

        .search-container {
            position: relative;
            margin-left: 2.5rem;
            flex-grow: 1;
            max-width: 400px;
        } 



         .hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--dark-color);
            padding: 0.5rem;
            z-index: 1001;
        }
        .hamburger i {
            display: none;
        }
        .dark-mode .hamburger {
            color: var(--text-dark);
        }

        @media (max-width: 768px) {
            .hamburger {
              
                display: block;
                background-color: transparent;
                border: none;
                position: absolute;
                right: 10px;
                top: 15px;
                padding: 15px;
            }
.hamburger i {
    display: block;
            transition: var(--transition);
            font-size: 1.5rem;}


            .navbar {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem 0;
                position: relative;
            }

            .nav-menu {
                position: fixed;
                top: 0;
                left: -100%;
                width: 70%;
                height: 100vh;
                background: white;
                flex-direction: column;
                padding: 5rem 2rem 2rem;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                transition: var(--transition);
                z-index: 1000;
                overflow-y: auto;
            }

            .dark-mode .nav-menu {
                background: var(--card-dark);
                box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            }

            .nav-menu.active {
                left: 0;
            }

            .nav-link {
                width: 100%;
                padding: 1rem;
                border-radius: 0;
                border-bottom: 1px solid var(--light-color);
            }

            .dark-mode .nav-link {
                border-bottom: 1px solid #2a2a4a;
            }

            .search-container {
                margin-left: 0;
                width: 100%;
                max-width: none;
                order: 3;
                margin-top: 1rem;
            }

            .theme-toggle {
                position: absolute;
                top: 20px;
                right: 60px;
            }
        }

        @media (max-width: 480px) {
            .nav-menu {
                width: 85%;
            }
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

        .search-input {
            padding: 0.8rem 1rem 0.8rem 3rem;
            border: 2px solid var(--light-color);
            border-radius: 25px;
            outline: none;
            transition: var(--transition);
            width: 100%;
            background: var(--white);
            font-size: 0.95rem;
        }

        .dark-mode .search-input {
            background: var(--card-dark);
            border-color: #2a2a4a;
            color: var(--text-dark);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
            transform: scale(1.02);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            pointer-events: none;
        }

        .hero {
            background-image: url('https://media.istockphoto.com/id/2166737641/photo/food-and-drink-ready-to-eat-for-breakfast-in-restaurant-fried-egg-on-sandwich-with-cappuccino.webp?a=1&b=1&s=612x612&w=0&k=20&c=pcenAfdZuSh4kOp01h4vSRyl_IZkV38JdsnCak1BJ04=');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
            text-align: center;
            padding: 6rem 0;
            color: white;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        .hero .container {
            position: relative;
            z-index: 2;
        }

        .dark-mode .hero {
            color: var(--text-dark);
        }

        .hero h1 {
            font-size: 3.5rem;
            font-family: 'Aleo', serif;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease-out;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cta-button {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-medium);
            margin: 0.5rem;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .premium-btn {
            background: var(--gradient-premium);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
        }

        .main-content {
            background: white;
            margin: 2rem 0;
            border-radius: 20px;
            box-shadow: var(--shadow-medium);
            overflow: hidden;
            transition: var(--transition);
        }

        .dark-mode .main-content {
            background: var(--card-dark);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .section {
            padding: 3rem 2rem;
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 3rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .premium-title {
            background: var(--gradient-premium);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 3rem;
            transition: var(--transition);
        }

        .dark-mode .footer {
            background: #0f0f1a;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: #bbb;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section ul li a:hover {
            color: var(--primary-color);
        }

        .footer p {
            opacity: 0.8;
            border-top: 1px solid #333;
            padding-top: 2rem;
            margin-top: 2rem;
        }

        /* ================= */
        /* COMPOSANTS COMMUNS */
        /* ================= */
        .filters {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--light-color);
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .dark-mode .filter-btn {
            background: var(--card-dark);
            border-color: #2a2a4a;
            color: var(--text-dark);
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-premium {
            background: var(--gradient-premium);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .dark-mode .btn-outline {
            color: var(--text-dark);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .dark-mode .error-message {
            color: #a0a0c0;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--danger);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .premium-badge {
            background: var(--gradient-premium);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .premium-feature {
            background: rgba(241, 196, 15, 0.1);
            border-left: 4px solid var(--premium-color);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .dark-mode .premium-feature {
            background: rgba(241, 196, 15, 0.15);
        }

        /* ===================== */
        /* COMPOSANTS DE RECETTES */
        /* ===================== */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .recipe-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            position: relative;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .dark-mode .recipe-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .recipe-image-container {
            position: relative;
            overflow: hidden;
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        .recipe-image-container img{
            width: 100%;
            height: 100%;
            align-items: center;

            object-fit: cover;
            transition: var(--transition);
        }


        .recipe-image {
            width: 100%;
            background-size: cover;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .recipe-card:hover .recipe-image {
            transform: scale(1.05);
        }

        .recipe-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .recipe-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            line-height: 1.4;
        }

        .dark-mode .recipe-title {
            color: var(--text-dark);
        }

        .recipe-description {
            color: var(--gray);
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
            line-height: 1.5;
        }

        .dark-mode .recipe-description {
            color: #a0a0c0;
        }

        .recipe-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .recipe-time {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .dark-mode .recipe-time {
            color: #a0a0c0;
        }

        .recipe-difficulty {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .difficulty-easy {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success);
        }

        .difficulty-medium {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .difficulty-hard {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .recipe-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: auto;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
            z-index: 10;
        }

        .dark-mode .favorite-btn {
            background: rgba(26, 26, 46, 0.9);
        }

        .favorite-btn:hover,
        .favorite-btn.active {
            color: var(--danger);
            background: white;
            transform: scale(1.1);
        }

        /* ================== */
        /* MODAL DETAIL RECETTE */
        /* ================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        .dark-mode .modal-content {
            background: var(--card-dark);
        }

        .modal-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .dark-mode .modal-header {
            background: var(--card-dark);
            border-bottom: 1px solid #2a2a4a;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--danger);
            background: rgba(231, 76, 60, 0.1);
        }

        .modal-body {
            padding: 2rem;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .recipe-detail-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            
        }

        .recipe-detail-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            padding: 1.5rem;
            background: var(--light-color);
            border-radius: var(--border-radius);
        }

        .dark-mode .recipe-detail-meta {
            background: #2a2a4a;
        }

        .meta-item {
            text-align: center;
        }

        .meta-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .meta-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .dark-mode .meta-label {
            color: #a0a0c0;
        }

        .ingredients-list,
        .instructions-list {
            margin: 2rem 0;
        }

        .ingredients-list h3,
        .instructions-list h3 {
            margin-bottom: 1rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-mode .ingredients-list h3,
        .dark-mode .instructions-list h3 {
            color: var(--text-dark);
        }

        .ingredients-list ul {
            list-style: none;
            padding: 0;
        }

        .ingredients-list li {
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .ingredients-list li:hover {
            background: rgba(255, 107, 107, 0.05);
            padding-left: 1rem;
        }

        .dark-mode .ingredients-list li {
            border-bottom: 1px solid #2a2a4a;
        }

        .ingredients-list li::before {
            content: '✓';
            color: var(--success);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .instructions-list ol {
            padding-left: 1.5rem;
        }

        .instructions-list li {
            margin-bottom: 1.5rem;
            line-height: 1.6;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .dark-mode .instructions-list li {
            background: rgba(255, 255, 255, 0.05);
        }

        .nutrition-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin: 2rem 0;
        }

        .dark-mode .nutrition-info {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .nutrition-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        .dark-mode .nutrition-item {
            background: rgba(255, 255, 255, 0.05);
        }

        .nutrition-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nutrition-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ============== */
        /* SECTION PREMIUM */
        /* ============== */
        .premium-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .plan-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .plan-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        .plan-card.premium {
            border: 2px solid var(--premium-color);
            transform: scale(1.05);
        }

        .plan-card.premium::before {
            content: 'POPULAIRE';
            position: absolute;
            top: 10px;
            right: -30px;
            background: var(--premium-color);
            color: white;
            padding: 0.3rem 2rem;
            transform: rotate(45deg);
            font-size: 0.8rem;
            font-weight: bold;
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .dark-mode .plan-name {
            color: var(--text-dark);
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .dark-mode .plan-price {
            color: var(--text-dark);
        }

        .plan-card.premium .plan-price {
            color: var(--premium-color);
        }

        .plan-features {
            list-style: none;
            margin-bottom: 2rem;
            text-align: left;
        }

        .plan-features li {
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-mode .plan-features li {
            border-bottom: 1px solid #2a2a4a;
            color: var(--text-dark);
        }

        .plan-features li i {
            width: 20px;
            text-align: center;
        }

        /* ======================= */
        /* PLANIFICATEUR DE REPAS */
        /* ======================= */
        .meal-planner {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .day-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            padding: 1.5rem;
        }

        .dark-mode .day-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .day-card h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            text-align: center;
        }

        .meal-item {
            padding: 0.8rem;
            background: var(--light-color);
            border-radius: var(--border-radius);
            border: 3px solid;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            border-color: var(--premium-color);
        }


.meal-item h4{
    font-family: 'Courier New';
    font-weight: italic;
    font-size: 1.2rem;
    color: var(--warning);

}

        .dark-mode .meal-item {
            background: #2a2a4a;
        }

        .meal-item:hover {
            background: rgba(255, 107, 107, 0.1);
            transform: translateX(5px);
        }

        .dark-mode .meal-item:hover {
            background: rgba(255, 107, 107, 0.15);
        }

        .ajouter-com {
            border-radius: 20px;
            background: var(--light-color);
            color: rgb(12, 11, 11);   
            padding: 20px;
            border: none;
            width: 100%;
            resize: vertical;
            min-height: 100px;
        }

        .ajouter-com::placeholder {
            color: rgba(31, 29, 29, 0.8);
        }

        @keyframes mealAppear {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Styles améliorés pour le planificateur */
        .meal-plan-result {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-top: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        .dark-mode .meal-plan-result {
            background: linear-gradient(135deg, rgba(26,26,46,0.3) 0%, rgba(22,33,62,0.3) 100%);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .meal-plan-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-premium);
            z-index: 1;
        }

        .meal-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 2;
        }

        .meal-plan-header h3 {
            font-size: 1.8rem;
            background: var(--gradient-premium);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .meal-plan-actions {
            display: flex;
            gap: 1rem;
        }

        .meal-plan-day {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
            transition: var(--transition);
            animation: mealAppear 0.5s ease-out;
            
        }

        .dark-mode .meal-plan-day {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .meal-plan-day:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: rgba(241, 196, 15, 0.1);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .day-header {
            background: rgba(241, 196, 15, 0.08);
        }

        .day-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 5px;
            background: var(--premium-color);
        }

        .day-header h4 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .dark-mode .day-header h4 {
            color: var(--text-dark);
        }

        .day-date {
            font-size: 0.9rem;
            color: var(--gray);
            background: rgba(255,255,255,0.8);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
        }

        .dark-mode .day-date {
            background: rgba(255,255,255,0.1);
            color: #a0a0c0;
        }

        .meals-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .meal-card {
            background: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .dark-mode .meal-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .meal-time {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.9);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .dark-mode .meal-time {
            background: rgba(26,26,46,0.9);
        }

        .meal-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .meal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--dark-color);
        }

        .dark-mode .meal-title {
            color: var(--text-dark);
        }

        .meal-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.2rem;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .meal-meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--gray);
        }

        .dark-mode .meal-meta-item {
            color: #a0a0c0;
        }

        .meal-actions {
            margin-top: auto;
            display: flex;
            gap: 0.8rem;
        }

        .nutrition-summary {
            background: linear-gradient(135deg, #4ecdc4 0%, #45b7d1 100%);
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .dark-mode .nutrition-summary {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
        }

        .nutrition-item {
            text-align: center;
            padding: 1rem;
        }

        .nutrition-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .nutrition-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meal-plan-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .dark-mode .meal-plan-footer {
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .meal-plan-calories {
            font-size: 1.2rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .meal-plan-buttons {
            display: flex;
            gap: 1rem;
        }

        /* Animation pour les nouveaux éléments */
        .animate-pop {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Drag and drop styles */
        .draggable {
            cursor: grab;
            transition: transform 0.2s;
        }

        .draggable:active {
            cursor: grabbing;
        }

        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .drop-zone {
            background-color: rgba(241, 196, 15, 0.1);
            border: 2px dashed var(--premium-color);
            border-radius: var(--border-radius);
            min-height: 100px;
            padding: 1rem;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .drop-zone.highlight {
            background-color: rgba(241, 196, 15, 0.2);
        }

        /* =============== */
        /* SECTION ADMIN */
        /* =============== */
        .admin-dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            min-height: 600px;
        }

        .admin-sidebar {
            background: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .dark-mode .admin-sidebar {
            background: var(--card-dark);
        }

        .admin-sidebar h3 {
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        .dark-mode .admin-sidebar h3 {
            border-bottom: 1px solid #2a2a4a;
            color: var(--text-dark);
        }

        .admin-nav {
            list-style: none;
        }

        .admin-nav li {
            margin-bottom: 0.5rem;
        }

        .admin-nav a {
            display: block;
            padding: 0.8rem;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-mode .admin-nav a {
            color: var(--text-dark);
        }

        .admin-nav a:hover,
        .admin-nav a.active {
            background: var(--gradient-primary);
            color: white;
        }

        .admin-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-light);
        }

        .dark-mode .admin-content {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .admin-section h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .dark-mode .admin-table {
            border: 1px solid #2a2a4a;
        }

        .admin-table th, 
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--light-color);
        }

        .dark-mode .admin-table th,
        .dark-mode .admin-table td {
            border-bottom: 1px solid #2a2a4a;
            color: var(--text-dark);
        }

        .admin-table th {
            background: var(--light-color);
            font-weight: 600;
        }

        .dark-mode .admin-table th {
            background: #2a2a4a;
        }

        .admin-table tr:hover {
            background: rgba(255, 107, 107, 0.05);
        }

        .dark-mode .admin-table tr:hover {
            background: rgba(255, 107, 107, 0.08);
        }

        .admin-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .dark-mode .form-group label {
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .dark-mode .form-group input,
        .dark-mode .form-group textarea,
        .dark-mode .form-group select {
            background: #2a2a4a;
            border: 1px solid #3a3a5a;
            color: var(--text-dark);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .admin-recipe-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .form-column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .ingredients-editor {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .ingredient-item {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .ingredient-item input {
            flex: 1;
        }


.meal-item a{
            text-decoration: none;
            color: var(--gray);
            transition: var(--transition);
        }

        .meal-item a:hover {
            color: var(--primary-color);
}


        /* =============== */
        /* FORMULAIRES */
        /* =============== */
        .login-container {
            max-width: 500px;
            margin: 2rem auto;
            background: white;
            padding: 3rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
        }
        
        .dark-mode .login-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .login-form .form-group {
            margin-bottom: 1.5rem;
        }
        
        .login-form input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }
        
        .dark-mode .login-form input {
            background: #2a2a4a;
            border: 1px solid #3a3a5a;
            color: var(--text-dark);
        }
        
        .login-form button {
            width: 100%;
            padding: 1rem;
        }
        
        .login-options {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .login-options a {
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .login-options a:hover {
            text-decoration: underline;
        }
        
        .payment-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
        }
        
        .dark-mode .payment-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .payment-form {
            margin-top: 2rem;
        }
        
        .payment-method {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .payment-card {
            flex: 1;
            border: 2px solid #eee;
            border-radius: var(--border-radius);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .dark-mode .payment-card {
            background: #2a2a4a;
            border: 2px solid #3a3a5a;
        }
        
        .payment-card.active {
            border-color: var(--primary-color);
            background: rgba(255, 107, 107, 0.05);
        }
        
        .dark-mode .payment-card.active {
            background: rgba(255, 107, 107, 0.1);
        }
        
        .payment-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .card-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* =============== */
        /* AUTRES SECTIONS */
        /* =============== */
        .access-denied {
            text-align: center;
            padding: 3rem;
        }
        
        .access-denied i {
            font-size: 5rem;
            color: var(--danger);
            margin-bottom: 1rem;
        }

        .user-menu {
            position: relative;
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            min-width: 200px;
            box-shadow: var(--shadow-medium);
            border-radius: var(--border-radius);
            z-index: 100;
            padding: 1rem;
            list-style: none;
        }

        .dark-mode .user-dropdown {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .user-menu:hover .user-dropdown {
            display: block;
        }

        .user-dropdown li {
            margin-bottom: 0.5rem;
        }

        .user-dropdown a {
            display: block;
            padding: 0.5rem;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-mode .user-dropdown a {
            color: var(--text-dark);
        }

        .user-dropdown a:hover {
            background: var(--light-color);
        }

        .dark-mode .user-dropdown a:hover {
            background: #2a2a4a;
        }

        /* Mode sombre toggle */
        .theme-toggle {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
            transition: var(--transition);
            margin-left: 1rem;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .dark-mode .theme-toggle {
            color: var(--text-dark);
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
            background: rgba(255, 107, 107, 0.1);
        }

        /* Animation de paiement */
        .payment-success {
            text-align: center;
            padding: 3rem;
        }

        .payment-success i {
            font-size: 5rem;
            color: var(--success);
            margin-bottom: 1rem;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Comments section */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--light-color);
        }

        .dark-mode .comments-section {
            border-top: 1px solid #2a2a4a;
        }

        .comment {
            
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .dark-mode .comment {
            background: #2a2a4a;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .comment-header strong {
            color: var(--primary-color);
        }

        .comment-header span {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .add-comment {
            margin-top: 1rem;
        }

        .add-comment textarea {
            margin-bottom: 1rem;
        }

        /* ================= */
        /* RESPONSIVE DESIGN */
        /* ================= */
        @media (max-width: 768px) {
            /* .navbar {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-direction: column;
                gap: 1rem;
                width: 100%;
            } */

            .search-container {
                margin-left: 0;
                width: 100%;
                max-width: none;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero {
                padding: 4rem 0;
            }

            .recipes-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-dashboard {
                grid-template-columns: 1fr;
            }
            
            .admin-recipe-form {
                grid-template-columns: 1fr;
            }

            .premium-plans {
                grid-template-columns: 1fr;
            }

            .plan-card.premium {
                transform: none;
            }

            .modal-content {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }

            .meal-plan-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .meals-container {
                grid-template-columns: 1fr;
            }
            
            .meal-plan-footer {
                flex-direction: column;
                gap: 1.5rem;
                align-items: flex-start;
            }
            
            .meal-plan-buttons {
                width: 100%;
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .card-input-group {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }

            .section {
                padding: 2rem 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .recipe-card {
                margin: 0 auto;
                max-width: 350px;
            }

            .modal-body {
                padding: 1rem;
            }

            .login-container,
            .payment-container {
                margin: 1rem;
                padding: 2rem 1rem;
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles for better accessibility */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus,
        .nav-link:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --shadow-light: 0 2px 10px rgba(0,0,0,0.3);
                --shadow-medium: 0 4px 20px rgba(0,0,0,0.4);
                --shadow-heavy: 0 8px 30px rgba(0,0,0,0.5);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" id="appHeader">
        <div class="container">
           <nav class="navbar">
                <!-- <button class="hamburger" id="hamburger" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button> -->
                
                <div class="logo">
                    <i class="fas fa-utensils"></i> RecipeHub
                </div>

                <div class="overlay" id="overlay"></div>
                
                <ul class="nav-menu" id="navMenu">
                    <!-- Navigation items will be dynamically added here -->
                </ul>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Rechercher une recette..." id="searchInput">
                </div>
                
                <button class="theme-toggle" id="themeToggle" aria-label="Basculer le mode sombre">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="hamburger" id="hamburger" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="heroSection">
        <div class="container">
            <h1>Découvrez des Recettes Délicieuses</h1>
            <p>Explorez des milliers de recettes du monde entier avec des APIs réelles</p>
            <div id="heroButtons">
                <!-- Buttons will be dynamically added based on auth state -->
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Section Accueil -->
            <section id="home" class="section active">
                <h2 class="section-title">Bienvenue sur RecipeHub</h2>
                <p style="text-align: center; font-size: 1.1rem; color: var(--gray); margin-bottom: 3rem;">
                    Ce projet étudiant utilise de vraies APIs gratuites pour vous proposer des recettes authentiques du monde entier.
                </p>

                <div class="recipes-grid" id="featuredRecipes">
                    <!-- Recettes en vedette chargées ici -->
                </div>
            </section>

            <!-- Section Recettes -->
            <section id="recipes" class="section">
                <h2 class="section-title">Toutes les Recettes</h2>

                <!-- Filtres -->
                <div class="filters">
                    <button class="filter-btn active" onclick="filterRecipes('all')">
                        <i class="fas fa-th"></i> Toutes
                    </button>
                    <button class="filter-btn" onclick="filterRecipes('breakfast')">
                        <i class="fas fa-coffee"></i> Petit-déjeuner
                    </button>
                    <button class="filter-btn" onclick="filterRecipes('lunch')">
                        <i class="fas fa-hamburger"></i> Déjeuner
                    </button>
                    <button class="filter-btn" onclick="filterRecipes('dinner')">
                        <i class="fas fa-utensils"></i> Dîner
                    </button>
                    <button class="filter-btn" onclick="filterRecipes('dessert')">
                        <i class="fas fa-ice-cream"></i> Dessert
                    </button>
                    <button class="filter-btn" onclick="filterRecipes('vegetarian')">
                        <i class="fas fa-leaf"></i> Végétarien
                    </button>
                </div>

                <!-- Loading -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                </div>

                <!-- Grid des recettes -->
                <div class="recipes-grid" id="recipesGrid">
                    <!-- Recettes chargées ici -->
                </div>

                <!-- Message d'erreur -->
                <div id="errorMessage" class="error-message" style="display: none;">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Oups ! Impossible de charger les recettes</h3>
                    <p>Vérifiez votre connexion internet et réessayez.</p>
                    <button class="btn btn-primary" onclick="loadRecipes()">
                        <i class="fas fa-redo"></i> Réessayer
                    </button>
                </div>
            </section>

            <!-- Section Favoris -->
            <section id="favorites" class="section">
                <h2 class="section-title">Mes Recettes Favorites</h2>
                <div class="recipes-grid" id="favoritesGrid">
                 <!-- Favoris chargés ici -->
                </div>
               <div id="noFavorites" style="text-align: center; padding: 3rem; color: var(--gray);">
                    <i class="fas fa-heart" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <h3>Aucune recette favorite</h3>
                    <p>Ajoutez des recettes à vos favoris en cliquant sur le cœur ❤️</p>
                </div>
            </section>

            <!-- Section Premium -->
            <section id="premium" class="section">
                <h2 class="section-title premium-title">Accès Premium</h2>
                
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        Passez à RecipeHub Premium pour débloquer des fonctionnalités exclusives qui transformeront votre expérience culinaire.
                    </p>
                    
                    <div class="premium-plans">
                        <div class="plan-card">
                            <h3 class="plan-name">Gratuit</h3>
                            <div class="plan-price">€0<span style="font-size: 1rem;">/mois</span></div>
                            <ul class="plan-features">
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Accès aux recettes de base</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Recherche par catégorie</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Favoris illimités</li>
                                <li><i class="fas fa-times" style="color: var(--danger);"></i> Planification des repas</li>
                                <li><i class="fas fa-times" style="color: var(--danger);"></i> Calcul de calories</li>
                                <li><i class="fas fa-times" style="color: var(--danger);"></i> Recettes exclusives</li>
                            </ul>
                            <button class="btn btn-outline" onclick="showSection('recipes')">Utiliser la version gratuite</button>
                        </div>
                        
                        <div class="plan-card premium">
                            <h3 class="plan-name">Premium</h3>
                            <div class="plan-price">€4.99<span style="font-size: 1rem;">/mois</span></div>
                            <ul class="plan-features">
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Toutes les fonctionnalités gratuites</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Planificateur de repas hebdomadaire</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Calcul des calories par recette</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Suggestions de recettes personnalisées</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Accès aux recettes exclusives</li>
                                <li><i class="fas fa-check" style="color: var(--success);"></i> Pas de publicités</li>
                            </ul>
                            <button class="btn btn-premium" onclick="initiatePayment()">
                                <i class="fas fa-crown"></i> S'abonner maintenant
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin: 3rem 0;">
                        <h3>Fonctionnalités Premium</h3>
                        
                        <div class="premium-feature">
                            <h4><i class="fas fa-calendar-alt"></i> Planification des repas</h4>
                            <p>Générez automatiquement un plan de repas hebdomadaire adapté à vos préférences et objectifs nutritionnels.</p>
                            <button class="btn btn-premium" onclick="showSection('mealPlanner')">Essayer</button>
                        </div>
                        
                        <div class="premium-feature">
                            <h4><i class="fas fa-calculator"></i> Calculateur de calories</h4>
                            <p>Obtenez une analyse nutritionnelle complète pour chaque recette, y compris le nombre de calories, protéines, glucides et lipides.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section Planificateur de repas -->
            <section id="mealPlanner" class="section">
                <h2 class="section-title premium-title">Planificateur de Repas</h2>
                
                <div style="max-width: 800px; margin: 0 auto;">
                    <p style="text-align: center; margin-bottom: 2rem;">
                        Générez un plan de repas personnalisé pour la semaine en fonction de vos préférences alimentaires.
                    </p>
                    
                    <div class="admin-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nombre de jours</label>
                                <select id="mealDays">
                                    <option value="3">3 jours</option>
                                    <option value="5">5 jours</option>
                                    <option value="7" selected>7 jours</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Régime alimentaire</label>
                                <select id="mealDiet">
                                    <option value="">Aucun</option>
                                    <option value="vegetarian">Végétarien</option>
                                    <option value="vegan">Végétalien</option>
                                    <option value="glutenFree">Sans gluten</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Calories cibles par jour</label>
                            <input type="number" id="mealCalories" value="2000" min="1000" max="4000">
                        </div>
                        
                        <button class="btn btn-premium" onclick="generateMealPlan()">
                            <i class="fas fa-magic"></i> Générer mon plan de repas
                        </button>
                    </div>
                    
                    <div id="mealPlanResult" class="meal-plan-result" style="display: none;">
                        <!-- Résultat du planificateur -->
                    </div>
                </div>
            </section>

            <!-- Section À propos -->
            <section id="about" class="section">
                <h2 class="section-title">À propos du Projet</h2>
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        RecipeHub est un projet étudiant développé avec des technologies web modernes.
                        Il utilise des APIs gratuites réelles pour fournir des recettes authentiques du monde entier.
                    </p>

                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin: 3rem 0;">                       
                       <div style="padding: 2rem; background: var(--gray); border-radius: var(--border-radius);" class="dark-mode-card">
                           <i class="fas fa-code" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                           <h3>Technologies</h3>
                           <p>HTML5, CSS3, JavaScript ES6+</p>
                       </div>
                       <div style="padding: 2rem; background: var(--gray); border-radius: var(--border-radius);" class="dark-mode-card">
                           <i class="fas fa-database" style="font-size: 2rem; color: var(--secondary-color); margin-bottom: 1rem;"></i>
                           <h3>APIs Utilisées</h3>
                           <p>TheMealDB, Spoonacular, Edamam</p>
                       </div>
                       <div style="padding: 2rem; background: var(--gray); border-radius: var(--border-radius);" class="dark-mode-card">
                           <i class="fas fa-mobile-alt" style="font-size: 2rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                           <h3>Responsive</h3>
                           <p>Compatible mobile, tablette, desktop</p>
                       </div>
                   </div>
               </div>
           </section>

            <!-- Section Admin -->
            <section id="admin" class="section">
                <h2 class="section-title">Interface d'Administration</h2>
                
                <div class="admin-dashboard">
                    <div class="admin-sidebar">
                        <h3>Tableau de bord</h3>
                        <ul class="admin-nav">
                            <li><a href="#" class="active" onclick="showAdminSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Tableau de bord</a></li>
                            <li><a href="#" onclick="showAdminSection('users')"><i class="fas fa-users"></i> Utilisateurs</a></li>
                            <li><a href="#" onclick="showAdminSection('recipes')"><i class="fas fa-utensils"></i> Recettes</a></li>
                            <li><a href="#" onclick="showAdminSection('categories')"><i class="fas fa-tags"></i> Catégories</a></li>
                            <li><a href="#" onclick="showAdminSection('subscriptions')"><i class="fas fa-crown"></i> Abonnements</a></li>
                            <li><a href="#" onclick="showAdminSection('comments')"><i class="fas fa-comments"></i> Commentaires</a></li>
                        </ul>
                    </div>
                    
                    <div class="admin-content">
                        <div id="admin-dashboard" class="admin-section active">
                            <h2>Tableau de bord</h2>
                            <p>Bienvenue dans l'interface d'administration de RecipeHub.</p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                                <div style="background: var(--light-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;" class="dark-mode-card">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="adminUsersCount">0</div>
                                    <div style="color: black;">Utilisateurs</div>
                                </div>
                                <div style="background: var(--light-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;" class="dark-mode-card">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="adminPremiumCount">0</div>
                                    <div style="color: black;">Abonnés Premium</div>
                                </div>
                                <div style="background: var(--light-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;" class="dark-mode-card">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="adminRecipesCount">0</div>
                                    <div style="color: black;">Recettes</div>
                                </div>
                                <div style="background: var(--light-color); border-radius: var(--border-radius); padding: 1.5rem; text-align: center;" class="dark-mode-card">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="adminCommentsCount">0</div>
                                    <div style="color: black;">Commentaires</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="admin-users" class="admin-section">
                            <h2>Gestion des Utilisateurs</h2>
                            <button class="btn btn-primary" onclick="showUserForm()" style="margin-bottom: 1rem;">
                                <i class="fas fa-plus"></i> Ajouter un utilisateur
                            </button>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nom</th>
                                        <th>Email</th>
                                        <th>Rôle</th>
                                        <th>Abonnement</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminUsersList">
                                    <!-- Users will be populated here -->
                                </tbody>
                            </table>

                            <div id="userFormContainer" style="display: none; margin-top: 2rem;">
                                <h3 id="userFormTitle">Ajouter un nouvel utilisateur</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <label>Nom complet</label>
                                        <input type="text" id="userName">
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" id="userEmail">
                                    </div>
                                    <div class="form-group">
                                        <label>Rôle</label>
                                        <select id="userRole">
                                            <option value="user">Utilisateur</option>
                                            <option value="admin">Administrateur</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Abonnement</label>
                                        <select id="userSubscription">
                                            <option value="free">Gratuit</option>
                                            <option value="premium">Premium</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Mot de passe</label>
                                        <input type="password" id="userPassword" placeholder="Laissez vide pour garder actuel">
                                    </div>
                                    <button class="btn btn-primary" id="saveUserBtn" onclick="saveUser()">
                                        <i class="fas fa-save"></i> Enregistrer
                                    </button>
                                    <button class="btn btn-outline" onclick="cancelUserForm()">
                                        <i class="fas fa-times"></i> Annuler
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="admin-recipes" class="admin-section">
                            <h2>Gestion des Recettes</h2>
                            <button class="btn btn-primary" onclick="showRecipeForm()" style="margin-bottom: 1rem;">
                                <i class="fas fa-plus"></i> Ajouter une recette
                            </button>
                            
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nom</th>
                                        <th>Catégorie</th>
                                        <th>Difficulté</th>
                                        <th>Temps</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminRecipesList">
                                    <!-- Recipes will be populated here -->
                                </tbody>
                            </table>
                            
                            <div id="recipeFormContainer" style="display: none; margin-top: 2rem;">
                                <h3 id="recipeFormTitle">Ajouter une nouvelle recette</h3>
                                <div class="admin-form admin-recipe-form">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label>Nom de la recette</label>
                                            <input type="text" id="recipeName">
                                        </div>
                                        <div class="form-group">
                                            <label>Catégorie</label>
                                            <select id="recipeCategory">
                                                <option value="breakfast">Petit-déjeuner</option>
                                                <option value="lunch">Déjeuner</option>
                                                <option value="dinner">Dîner</option>
                                                <option value="dessert">Dessert</option>
                                                <option value="vegetarian">Végétarien</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Difficulté</label>
                                            <select id="recipeDifficulty">
                                                <option value="easy">Facile</option>
                                                <option value="medium">Moyen</option>
                                                <option value="hard">Difficile</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Temps de préparation (minutes)</label>
                                            <input type="number" id="recipeTime" min="5" max="240" value="30">
                                        </div>
                                        <div class="form-group">
                                            <label>Image URL</label>
                                            <input type="text" id="recipeImage" placeholder="https://example.com/image.jpg">
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label>Ingrédients</label>
                                            <div class="ingredients-editor" id="ingredientsContainer">
                                                <div class="ingredient-item">
                                                    <input type="text" placeholder="Ingrédient">
                                                    <button type="button" class="btn btn-outline" onclick="removeIngredient(this)"><i class="fas fa-minus"></i></button>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-outline" onclick="addIngredient()" style="margin-top: 0.5rem;">
                                                <i class="fas fa-plus"></i> Ajouter un ingrédient
                                            </button>
                                        </div>
                                        <div class="form-group">
                                            <label>Instructions</label>
                                            <textarea id="recipeInstructions" rows="6" placeholder="Étapes de préparation..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>Vidéo YouTube (optionnel)</label>
                                            <input type="text" id="recipeVideo" placeholder="URL de la vidéo">
                                        </div>
                                        <div class="form-group">
                                            <button class="btn btn-primary" id="saveRecipeBtn" onclick="saveRecipe()">
                                                <i class="fas fa-save"></i> Enregistrer
                                            </button>
                                            <button class="btn btn-outline" onclick="cancelRecipeForm()">
                                                <i class="fas fa-times"></i> Annuler
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="admin-categories" class="admin-section">
                            <h2>Gestion des Catégories</h2>
                            <button class="btn btn-primary" onclick="showCategoryForm()" style="margin-bottom: 1rem;">
                                <i class="fas fa-plus"></i> Ajouter une catégorie
                            </button>
                            
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nom</th>
                                        <th>Recettes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminCategoriesList">
                                    <!-- Categories will be populated here -->
                                </tbody>
                            </table>
                            
                            <div id="categoryFormContainer" style="display: none; margin-top: 2rem;">
                                <h3 id="categoryFormTitle">Ajouter une nouvelle catégorie</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <label>Nom de la catégorie</label>
                                        <input type="text" id="categoryName">
                                    </div>
                                    <div class="form-group">
                                        <label>Description</label>
                                        <textarea id="categoryDescription" rows="3"></textarea>
                                    </div>
                                    <button class="btn btn-primary" id="saveCategoryBtn" onclick="saveCategory()">
                                        <i class="fas fa-save"></i> Enregistrer
                                    </button>
                                    <button class="btn btn-outline" onclick="cancelCategoryForm()">
                                        <i class="fas fa-times"></i> Annuler
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="admin-subscriptions" class="admin-section">
                            <h2>Gestion des Abonnements</h2>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Utilisateur</th>
                                        <th>Type</th>
                                        <th>Date début</th>
                                        <th>Date fin</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminSubscriptionsList">
                                    <!-- Subscriptions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="admin-comments" class="admin-section">
                            <h2>Gestion des Commentaires</h2>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Recette</th>
                                        <th>Utilisateur</th>
                                        <th>Commentaire</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminCommentsList">
                                    <!-- Comments will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section Profil -->
            <section id="profile" class="section">
                <h2 class="section-title">Mon Profil</h2>
                
                <div style="max-width: 600px; margin: 0 auto;">
                    <div class="admin-form">
                        <div class="form-group">
                            <label>Nom complet</label>
                            <input type="text" id="profileName">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profileEmail">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" id="profilePassword" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label>Confirmer le mot de passe</label>
                            <input type="password" id="profilePasswordConfirm" placeholder="••••••••">
                        </div>
                        <button class="btn btn-primary" onclick="updateProfile()">
                            <i class="fas fa-save"></i> Mettre à jour
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Section Abonnement -->
            <section id="subscription" class="section">
                <h2 class="section-title premium-title">Mon Abonnement</h2>
                
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <div id="subscriptionInfo">
                        <!-- Subscription info will be populated here -->
                    </div>
                    
                    <h3>Historique des paiements</h3>
                    <table class="admin-table" style="margin: 1rem auto;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Méthode</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistory">
                            <!-- Payment history will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Section Connexion -->
            <section id="login" class="section">
                <div class="login-container">
                    <h2 style="text-align: center; margin-bottom: 2rem;">Connexion à RecipeHub</h2>
                    
                    <div class="login-form">
                        <div class="form-group">
                            <label>Adresse email</label>
                            <input type="email" id="loginEmail" placeholder="votre@email.fr">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" id="loginPassword" placeholder="••••••••">
                        </div>
                        <button class="btn btn-primary" onclick="login()">
                            <i class="fas fa-sign-in-alt"></i> Se connecter
                        </button>
                        
                        <div class="login-options">
                            <a href="#" onclick="showSection('register')">Créer un compte</a>
                            <a href="#">Mot de passe oublié?</a>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section Inscription -->
            <section id="register" class="section">
                <div class="login-container">
                    <h2 style="text-align: center; margin-bottom: 2rem;">Créer un compte RecipeHub</h2>
                    
                    <div class="login-form">
                        <div class="form-group">
                            <label>Nom complet</label>
                            <input type="text" id="registerName" placeholder="Votre nom">
                        </div>
                        <div class="form-group">
                            <label>Adresse email</label>
                            <input type="email" id="registerEmail" placeholder="votre@email.fr">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" id="registerPassword" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label>Confirmer le mot de passe</label>
                            <input type="password" id="registerPasswordConfirm" placeholder="••••••••">
                        </div>
                        <button class="btn btn-primary" onclick="register()">
                            <i class="fas fa-user-plus"></i> Créer mon compte
                        </button>
                        
                        <div class="login-options" style="justify-content: center; margin-top: 1rem;">
                            <a href="#" onclick="showSection('login')">J'ai déjà un compte</a>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section Paiement -->
            <section id="payment" class="section">
                <div class="payment-container">
                    <h2 style="text-align: center; margin-bottom: 1rem;">Abonnement Premium</h2>
                    <p style="text-align: center; color: var(--gray); margin-bottom: 2rem;">€4.99/mois - Accès illimité</p>
                    
                    <div class="payment-method">
                        <div class="payment-card active" id="cardPayment">
                            <i class="fas fa-credit-card"></i>
                            <div>Carte de crédit</div>
                        </div>
                        <div class="payment-card" id="paypalPayment">
                            <i class="fab fa-paypal"></i>
                            <div>PayPal</div>
                        </div>
                    </div>
                    
                    <div class="payment-form">
                        <div class="form-group">
                            <label>Numéro de carte</label>
                            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
                        </div>
                        
                        <div class="card-input-group">
                            <div class="form-group">
                                <label>Date d'expiration</label>
                                <input type="text" id="cardExpiry" placeholder="MM/AA">
                            </div>
                            <div class="form-group">
                                <label>CVV</label>
                                <input type="text" id="cardCvv" placeholder="123">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Titulaire de la carte</label>
                            <input type="text" id="cardName" placeholder="Nom complet">
                        </div>
                        
                        <button class="btn btn-premium" onclick="processPayment()">
                            <i class="fas fa-lock"></i> Payer maintenant
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Section Accès refusé -->
            <section id="accessDenied" class="section">
                <div class="access-denied">
                    <i class="fas fa-ban"></i>
                    <h2>Accès refusé</h2>
                    <p>Vous n'avez pas les autorisations nécessaires pour accéder à cette page.</p>
                    <button class="btn btn-primary" onclick="showSection('home')">
                        <i class="fas fa-home"></i> Retour à l'accueil
                    </button>
                </div>
            </section>
            
            <!-- Section Paiement Réussi -->
            <section id="paymentSuccess" class="section">
                <div class="payment-success">
                    <i class="fas fa-check-circle"></i>
                    <h2>Paiement Réussi !</h2>
                    <p>Merci pour votre abonnement Premium. Vous pouvez maintenant accéder à toutes les fonctionnalités exclusives.</p>
                    <button class="btn btn-premium" onclick="showSection('premium')">
                        <i class="fas fa-crown"></i> Découvrir Premium
                    </button>
                </div>
            </section>
       </div>
   </div>

   <!-- Modal pour les détails de recette -->
   <div class="modal" id="recipeModal">
       <div class="modal-content">
           <div class="modal-header">
               <h2 id="modalTitle">Détails de la Recette</h2>
               <button class="modal-close" onclick="closeModal()" aria-label="Fermer">&times;</button>
           </div>
           <div class="modal-body" id="modalBody">
               <!-- Contenu chargé dynamiquement -->
           </div>
       </div>
   </div>

   <!-- Footer -->
   <footer class="footer">
       <div class="container">
           <div class="footer-content">
               <div class="footer-section">
                   <h3>RecipeHub</h3>
                   <ul>
                       <li><a href="#" onclick="showSection('about')">À propos</a></li>
                       <li><a href="#" onclick="showSection('premium')">Premium</a></li>
                       <li><a href="#">Contact</a></li>
                       <li><a href="#">Aide</a></li>
                   </ul>
               </div>
               <div class="footer-section">
                   <h3>Recettes</h3>
                   <ul>
                       <li><a href="#" onclick="showSection('recipes'); filterRecipes('breakfast')">Petit-déjeuner</a></li>
                       <li><a href="#" onclick="showSection('recipes'); filterRecipes('lunch')">Déjeuner</a></li>
                       <li><a href="#" onclick="showSection('recipes'); filterRecipes('dinner')">Dîner</a></li>
                       <li><a href="#" onclick="showSection('recipes'); filterRecipes('dessert')">Desserts</a></li>
                   </ul>
               </div>
               <div class="footer-section">
                   <h3>Communauté</h3>
                   <ul>
                       <li><a href="#">Blog</a></li>
                       <li><a href="#">Forum</a></li>
                       <li><a href="#">Newsletter</a></li>
                       <li><a href="#">Réseaux sociaux</a></li>
                   </ul>
               </div>
               <div class="footer-section">
                   <h3>Légal</h3>
                   <ul>
                       <li><a href="#">Conditions d'utilisation</a></li>
                       <li><a href="#">Politique de confidentialité</a></li>
                       <li><a href="#">Cookies</a></li>
                       <li><a href="#">Mentions légales</a></li>
                   </ul>
               </div>
           </div>
           <p>&copy; 2024 RecipeHub - Projet Étudiant | Développé avec ❤️ et des APIs gratuites</p>
       </div>
   </footer>
<script>
 // ========================
// ÉTAT DE L'APPLICATION
// ========================
const appState = {
  currentUser: null,
  allRecipes: [],
  adminRecipes: [
    {
      id: 1001,
      title: "Tarte aux pommes maison",
      description: "Une délicieuse tarte aux pommes traditionnelle avec une pâte brisée croustillante.",
      image: "/placeholder.svg?height=200&width=300",
      category: "dessert",
      area: "France",
      time: 90,
      difficulty: "Moyen",
      source: "admin",
      instructions:
        "1. Préparer la pâte brisée\n2. Éplucher et couper les pommes\n3. Disposer les pommes sur la pâte\n4. Cuire au four 45 minutes à 180°C",
      ingredients: ["300g de farine", "150g de beurre", "1 œuf", "6 pommes", "100g de sucre", "1 pincée de sel"],
      youtube: null,
      createdAt: "2024-01-15T10:00:00Z",
    },
    {
      id: 1002,
      title: "Salade César authentique",
      description: "La vraie recette de la salade César avec sa sauce crémeuse et ses croûtons dorés.",
      image: "/placeholder.svg?height=200&width=300",
      category: "lunch",
      area: "Italie",
      time: 20,
      difficulty: "Facile",
      source: "admin",
      instructions:
        "1. Préparer la sauce César\n2. Laver et couper la salade\n3. Préparer les croûtons\n4. Assembler et servir",
      ingredients: [
        "2 cœurs de romaine",
        "100g de parmesan",
        "2 œufs",
        "4 filets d'anchois",
        "2 gousses d'ail",
        "Huile d'olive",
        "Pain de mie",
      ],
      youtube: null,
      createdAt: "2024-01-20T14:30:00Z",
    },
  ],
  favorites: JSON.parse(localStorage.getItem("favorites")) || [],
  currentFilter: "all",
  categories: [
    { id: "breakfast", name: "Petit-déjeuner", recipeCount: 0, description: "Recettes pour bien commencer la journée" },
    { id: "lunch", name: "Déjeuner", recipeCount: 0, description: "Plats principaux pour le midi" },
    { id: "dinner", name: "Dîner", recipeCount: 0, description: "Repas du soir savoureux" },
    { id: "dessert", name: "Dessert", recipeCount: 0, description: "Douceurs et gourmandises" },
    { id: "vegetarian", name: "Végétarien", recipeCount: 0, description: "Recettes sans viande" },
  ],
  users: [
    {
      id: 1,
      name: "Administrateur",
      email: "admin@recipehub.fr",
      password: "admin123",
      role: "admin",
      subscription: "premium",
      active: true,
      expiration: "2025-12-31",
      createdAt: "2024-01-01T00:00:00Z",
    },
    {
      id: 2,
      name: "Marie Dupont",
      email: "marie@example.fr",
      password: "password123",
      role: "user",
      subscription: "premium",
      active: true,
      expiration: "2024-12-31",
      createdAt: "2024-02-15T10:30:00Z",
    },
    {
      id: 3,
      name: "Jean Martin",
      email: "jean@example.fr",
      password: "password123",
      role: "user",
      subscription: "free",
      active: true,
      expiration: null,
      createdAt: "2024-03-01T16:45:00Z",
    },
  ],
  subscriptions: [
    {
      id: 1,
      userId: 1,
      type: "premium",
      startDate: "2024-01-01",
      endDate: "2025-12-31",
      status: "active",
    },
    {
      id: 2,
      userId: 2,
      type: "premium",
      startDate: "2024-02-15",
      endDate: "2024-12-31",
      status: "active",
    },
  ],
  comments: [
    {
      id: 1,
      recipeId: "52772",
      userId: 2,
      text: "Excellente recette ! Très facile à réaliser et délicieuse.",
      date: "2024-05-28",
    },
    {
      id: 2,
      recipeId: "1001",
      userId: 3,
      text: "Ma grand-mère faisait la même tarte, merci pour cette recette !",
      date: "2024-06-01",
    },
  ],
  activityLog: [],
  darkMode: localStorage.getItem("darkMode") === "true",
  isLoading: false,
  filters: {
    category: "all",
    difficulty: "all",
    time: "all",
    area: "all",
    sort: "default",
  },
}

// ========================
// APIS CONFIGURATION
// ========================
const APIs = {
  mealDB: {
    base: "https://www.themealdb.com/api/json/v1/1",
    endpoints: {
      random: "/random.php",
      search: "/search.php?s=",
      category: "/filter.php?c=",
      detail: "/lookup.php?i=",
      categories: "/categories.php",
    },
  },
  spoonacular: {
    base: "https://api.spoonacular.com",
    key: "6a38682d07f14205ab029913566198ea",
    endpoints: {
      mealPlan: "/mealplanner/generate",
      nutrition: "/recipes/guessNutrition",
      search: "/recipes/complexSearch",
    },
  },
}

// ========================
// INITIALISATION DE L'APP
// ========================
document.addEventListener("DOMContentLoaded", () => {
  console.log("🚀 Initialisation de RecipeHub...")

  // Initialisation du thème
  initTheme()

  // Vérification de l'utilisateur connecté
  initUser()

  // Initialisation de l'interface
  initUI()

  // Configuration des événements
  setupEventListeners()

  // Chargement initial des données
  loadInitialData()

  // Affichage de la page d'accueil
  showSection("home")

  console.log("✅ RecipeHub initialisé avec succès")
})

function initTheme() {
  if (appState.darkMode) {
    document.body.classList.add("dark-mode")
    const themeToggle = document.getElementById("themeToggle")
    if (themeToggle) {
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>'
    }
  }
}

function initUser() {
  const savedUser = localStorage.getItem("currentUser")
  if (savedUser) {
    try {
      appState.currentUser = JSON.parse(savedUser)
      // Vérifier que l'utilisateur existe toujours
      const userExists = appState.users.find((u) => u.id === appState.currentUser.id)
      if (!userExists) {
        appState.currentUser = null
        localStorage.removeItem("currentUser")
      }
    } catch (error) {
      console.error("Erreur lors du chargement de l'utilisateur:", error)
      appState.currentUser = null
      localStorage.removeItem("currentUser")
    }
  }
}

function loadInitialData() {
  loadFeaturedRecipes()
  loadRecipes()
  updateFavoritesDisplay()

  if (appState.currentUser?.role === "admin") {
    initAdminDashboard()
  }
}

// =====================
// GESTION DE L'INTERFACE
// =====================
function initUI() {
  updateNavigation()
  updateHeroSection()
}

function updateNavigation() {
  const navMenu = document.getElementById("navMenu")
  if (!navMenu) return

  navMenu.innerHTML = ""

  // Liens de base
  const commonLinks = [
    { id: "home", text: "Accueil", icon: "fas fa-home" },
    { id: "recipes", text: "Recettes", icon: "fas fa-utensils" },
    { id: "about", text: "À propos", icon: "fas fa-info-circle" },
  ]

  commonLinks.forEach((link) => {
    navMenu.appendChild(createNavLink(link))
  })

  // Liens utilisateur connecté
  if (appState.currentUser) {
    const userLinks = [
      { id: "favorites", text: "Favoris", icon: "fas fa-heart" },
      { id: "premium", text: "Premium", icon: "fas fa-crown" },
    ]

    userLinks.forEach((link) => {
      navMenu.appendChild(createNavLink(link))
    })

    // Planificateur de repas (premium)
    const mealPrepLi = document.createElement("li")
    mealPrepLi.innerHTML = `
            <a href="#" class="nav-link" onclick="showSection('mealPlanner')">
                <i class="fas fa-calendar-alt"></i> Meal Prep
                ${appState.currentUser.subscription !== "premium" ? '<span class="premium-badge">Premium</span>' : ""}
            </a>
        `
    navMenu.appendChild(mealPrepLi)

    // Menu utilisateur
    navMenu.appendChild(createUserMenu())
  } else {
    // Lien de connexion
    navMenu.appendChild(createLoginLink())
  }
}

function updateHeroSection() {
  const heroButtons = document.getElementById("heroButtons")
  if (!heroButtons) return

  if (appState.currentUser) {
    heroButtons.innerHTML = `
            <a href="#" class="cta-button" onclick="showSection('recipes')">
                <i class="fas fa-search"></i> Explorer les recettes
            </a>
            ${
              appState.currentUser.subscription === "free"
                ? `
            <a href="#" class="cta-button premium-btn" onclick="showSection('premium')">
                <i class="fas fa-crown"></i> Passer Premium
            </a>`
                : `
            <a href="#" class="cta-button premium-btn" onclick="showSection('mealPlanner')">
                <i class="fas fa-calendar-alt"></i> Planifier mes repas
            </a>`
            }
        `
  } else {
    heroButtons.innerHTML = `
            <a href="#" class="cta-button" onclick="showSection('recipes')">
                <i class="fas fa-search"></i> Découvrir les recettes
            </a>
            <a href="#" class="cta-button" onclick="showSection('login')">
                <i class="fas fa-sign-in-alt"></i> Se connecter
            </a>
        `
  }
}

// =================
// GESTION DES PAGES
// =================
function showSection(sectionId) {
  console.log(`📄 Affichage de la section: ${sectionId}`)

  // Vérification des permissions
  if (!hasPermission(sectionId)) {
    sectionId = "accessDenied"
  }

  // Masquer toutes les sections
  document.querySelectorAll(".section").forEach((section) => {
    section.classList.remove("active")
  })

  // Afficher la section demandée
  const targetSection = document.getElementById(sectionId)
  if (targetSection) {
    targetSection.classList.add("active")

    // Scroll vers le haut
    window.scrollTo({ top: 0, behavior: "smooth" })

    // Chargement spécifique selon la section
    loadSectionData(sectionId)
  } else {
    console.error(`Section non trouvée: ${sectionId}`)
  }
}

function hasPermission(sectionId) {
  const restrictedSections = {
    admin: () => isAdmin(),
    profile: () => !!appState.currentUser,
    subscription: () => !!appState.currentUser,
    favorites: () => !!appState.currentUser,
    mealPlanner: () => hasPremiumAccess(),
  }

  return !restrictedSections[sectionId] || restrictedSections[sectionId]()
}

function loadSectionData(sectionId) {
  const loaders = {
    recipes: loadRecipes,
    favorites: loadFavorites,
    home: loadFeaturedRecipes,
    admin: () => showAdminSection("dashboard"),
    subscription: loadSubscriptionInfo,
    profile: loadProfileData,
    mealPlanner: () => console.log("Planificateur de repas chargé"),
  }

  if (loaders[sectionId]) {
    loaders[sectionId]()
  }
}

// =====================
// AUTHENTIFICATION
// =====================
function login() {
  const email = document.getElementById("loginEmail")?.value?.trim()
  const password = document.getElementById("loginPassword")?.value

  if (!email || !password) {
    showToast("Veuillez remplir tous les champs", "error")
    return
  }

  const user = appState.users.find((u) => u.email === email && u.password === password && u.active !== false)

  if (user) {
    appState.currentUser = user
    localStorage.setItem("currentUser", JSON.stringify(user))

    // Log de l'activité
    logActivity("login", `Connexion de ${user.name}`)

    showToast(`Bienvenue, ${user.name} !`, "success")
    initUI()
    showSection("home")

    // Fermer le menu mobile si ouvert
    closeMobileMenu()
  } else {
    showToast("Email ou mot de passe incorrect", "error")
  }
}

function register() {
  const name = document.getElementById("registerName")?.value?.trim()
  const email = document.getElementById("registerEmail")?.value?.trim()
  const password = document.getElementById("registerPassword")?.value
  const confirmPassword = document.getElementById("registerPasswordConfirm")?.value

  // Validation
  if (!name || !email || !password || !confirmPassword) {
    showToast("Veuillez remplir tous les champs", "error")
    return
  }

  if (!isValidEmail(email)) {
    showToast("Format d'email invalide", "error")
    return
  }

  if (password !== confirmPassword) {
    showToast("Les mots de passe ne correspondent pas", "error")
    return
  }

  if (password.length < 6) {
    showToast("Le mot de passe doit contenir au moins 6 caractères", "error")
    return
  }

  if (appState.users.some((u) => u.email === email)) {
    showToast("Cet email est déjà utilisé", "error")
    return
  }

  // Création du nouvel utilisateur
  const newUser = {
    id: Math.max(...appState.users.map((u) => u.id), 0) + 1,
    name,
    email,
    password,
    role: "user",
    subscription: "free",
    active: true,
    expiration: null,
    createdAt: new Date().toISOString(),
  }

  appState.users.push(newUser)
  appState.currentUser = newUser
  localStorage.setItem("currentUser", JSON.stringify(newUser))

  // Log de l'activité
  logActivity("register", `Inscription de ${newUser.name}`)

  showToast("Compte créé avec succès !", "success")
  initUI()
  showSection("home")
}

function logout() {
  if (appState.currentUser) {
    logActivity("logout", `Déconnexion de ${appState.currentUser.name}`)
  }

  appState.currentUser = null
  localStorage.removeItem("currentUser")
  showToast("Déconnexion réussie", "info")
  initUI()
  showSection("home")
  closeMobileMenu()
}

// =====================
// GESTION DU PROFIL
// =====================
function loadProfileData() {
  if (!appState.currentUser) return

  const fields = {
    profileName: appState.currentUser.name,
    profileEmail: appState.currentUser.email,
  }

  Object.entries(fields).forEach(([fieldId, value]) => {
    const field = document.getElementById(fieldId)
    if (field) field.value = value
  })
}

function updateProfile() {
  if (!appState.currentUser) return

  const name = document.getElementById("profileName")?.value?.trim()
  const email = document.getElementById("profileEmail")?.value?.trim()
  const password = document.getElementById("profilePassword")?.value
  const confirmPassword = document.getElementById("profilePasswordConfirm")?.value

  // Validation
  if (!name || !email) {
    showToast("Le nom et l'email sont obligatoires", "error")
    return
  }

  if (!isValidEmail(email)) {
    showToast("Format d'email invalide", "error")
    return
  }

  if (password && password !== confirmPassword) {
    showToast("Les mots de passe ne correspondent pas", "error")
    return
  }

  if (password && password.length < 6) {
    showToast("Le mot de passe doit contenir au moins 6 caractères", "error")
    return
  }

  // Vérifier l'unicité de l'email
  const emailExists = appState.users.some((u) => u.email === email && u.id !== appState.currentUser.id)

  if (emailExists) {
    showToast("Cet email est déjà utilisé", "error")
    return
  }

  // Mise à jour
  const userIndex = appState.users.findIndex((u) => u.id === appState.currentUser.id)
  if (userIndex !== -1) {
    appState.users[userIndex] = {
      ...appState.users[userIndex],
      name,
      email,
      ...(password && { password }),
      updatedAt: new Date().toISOString(),
    }

    appState.currentUser = appState.users[userIndex]
    localStorage.setItem("currentUser", JSON.stringify(appState.currentUser))

    logActivity("profile_update", `Mise à jour du profil de ${name}`)
    showToast("Profil mis à jour avec succès", "success")
    initUI()
  }
}

// =====================
// FONCTIONNALITÉS RECETTES
// =====================
async function loadFeaturedRecipes() {
  const container = document.getElementById("featuredRecipes")
  if (!container) return

  container.innerHTML = '<div class="loading"><div class="spinner"></div></div>'

  try {
    const recipes = []

    // Charger quelques recettes aléatoires depuis l'API
    for (let i = 0; i < 4; i++) {
      try {
        const response = await fetch(`${APIs.mealDB.base}${APIs.mealDB.endpoints.random}`)
        const data = await response.json()
        if (data.meals?.[0]) {
          recipes.push(formatMealDBRecipe(data.meals[0]))
        }
      } catch (error) {
        console.warn(`Erreur lors du chargement de la recette ${i + 1}:`, error)
      }
    }

    // Ajouter les recettes admin
    recipes.push(...appState.adminRecipes.slice(0, 2))

    displayRecipes(recipes, container)
  } catch (error) {
    console.error("Erreur lors du chargement des recettes en vedette:", error)
    container.innerHTML = `
            <div class="error-message">
                <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <h3>Impossible de charger les recettes</h3>
                <p>Vérifiez votre connexion internet</p>
                <button class="btn btn-primary" onclick="loadFeaturedRecipes()">
                    <i class="fas fa-redo"></i> Réessayer
                </button>
            </div>
        `
  }
}

async function loadRecipes() {
  const container = document.getElementById("recipesGrid")
  const loading = document.getElementById("loading")
  const errorMessage = document.getElementById("errorMessage")

  if (!container) return

  // Afficher le loading
  if (loading) loading.style.display = "block"
  if (errorMessage) errorMessage.style.display = "none"
  container.innerHTML = ""

  try {
    const recipes = []
    const categories = ["Chicken", "Beef", "Seafood", "Vegetarian", "Pasta", "Dessert"]

    // Charger des recettes par catégorie
    for (const category of categories) {
      try {
        const response = await fetch(`${APIs.mealDB.base}/filter.php?c=${category}`)
        const data = await response.json()

        if (data.meals) {
          const categoryRecipes = data.meals.slice(0, 3).map((meal) => formatMealDBRecipe(meal))
          recipes.push(...categoryRecipes)
        }
      } catch (error) {
        console.warn(`Erreur pour la catégorie ${category}:`, error)
      }
    }

    // Ajouter les recettes admin
    recipes.push(...appState.adminRecipes)

    // Sauvegarder dans l'état
    appState.allRecipes = recipes

    // Initialiser les filtres
    initFilters()

    // Afficher les recettes
    displayRecipes(recipes, container)
    updateFilterResults(recipes.length)
  } catch (error) {
    console.error("Erreur lors du chargement des recettes:", error)
    if (errorMessage) errorMessage.style.display = "block"
  } finally {
    if (loading) loading.style.display = "none"
  }
}

function formatMealDBRecipe(meal) {
  return {
    id: meal.idMeal,
    title: meal.strMeal,
    description: meal.strInstructions?.substring(0, 150) + "..." || "Description non disponible",
    image: meal.strMealThumb,
    category: mapCategory(meal.strCategory),
    area: meal.strArea || "International",
    time: Math.floor(Math.random() * 45) + 15, // Temps aléatoire entre 15 et 60 min
    difficulty: ["Facile", "Moyen", "Difficile"][Math.floor(Math.random() * 3)],
    source: "TheMealDB",
    instructions: meal.strInstructions,
    ingredients: extractIngredients(meal),
    youtube: meal.strYoutube,
  }
}

function mapCategory(apiCategory) {
  const categoryMap = {
    Chicken: "lunch",
    Beef: "dinner",
    Seafood: "dinner",
    Vegetarian: "vegetarian",
    Pasta: "lunch",
    Dessert: "dessert",
    Breakfast: "breakfast",
  }

  return categoryMap[apiCategory] || "lunch"
}

function extractIngredients(meal) {
  const ingredients = []
  for (let i = 1; i <= 20; i++) {
    const ingredient = meal[`strIngredient${i}`]
    const measure = meal[`strMeasure${i}`]

    if (ingredient?.trim()) {
      const fullIngredient = measure?.trim() ? `${measure.trim()} ${ingredient.trim()}` : ingredient.trim()
      ingredients.push(fullIngredient)
    }
  }
  return ingredients
}

function displayRecipes(recipes, container) {
  if (!recipes || recipes.length === 0) {
    container.innerHTML = `
            <div class="error-message">
                <div class="error-icon"><i class="fas fa-utensils"></i></div>
                <h3>Aucune recette trouvée</h3>
                <p>Essayez de modifier vos critères de recherche</p>
            </div>
        `
    return
  }

  container.innerHTML = recipes.map((recipe) => createRecipeCard(recipe)).join("")
}

function createRecipeCard(recipe) {
  const isFavorite = appState.favorites.includes(recipe.id)

  return `
        <div class="recipe-card" onclick="showRecipeDetail('${recipe.id}', '${recipe.source}')">
            <div class="recipe-image-container">
                <button class="favorite-btn ${isFavorite ? "active" : ""}"
                        onclick="toggleFavorite('${recipe.id}', event)"
                        title="${isFavorite ? "Retirer des favoris" : "Ajouter aux favoris"}">
                    <i class="fas fa-heart"></i>
                </button>
                ${recipe.source === "admin" ? '<span class="premium-badge">Maison</span>' : ""}
                <img src="${recipe.image}" alt="${recipe.title}" class="recipe-image" loading="lazy">
            </div>
            <div class="recipe-content">
                <h3 class="recipe-title">${recipe.title}</h3>
                <p class="recipe-description">${recipe.description}</p>
                <div class="recipe-meta">
                    <div class="recipe-time">
                        <i class="fas fa-clock"></i>
                        <span>${recipe.time} min</span>
                    </div>
                    <span class="recipe-difficulty difficulty-${recipe.difficulty.toLowerCase()}">
                        ${recipe.difficulty}
                    </span>
                </div>
                <div class="recipe-actions">
                    <button class="btn btn-primary" 
                            onclick="event.stopPropagation(); showRecipeDetail('${recipe.id}', '${recipe.source}')">
                        <i class="fas fa-eye"></i> Voir
                    </button>
                    <button class="btn btn-outline" 
                            onclick="event.stopPropagation(); shareRecipe('${recipe.id}')">
                        <i class="fas fa-share"></i> Partager
                    </button>
                </div>
            </div>
        </div>
    `
}

async function showRecipeDetail(recipeId, source = "TheMealDB") {
  const modal = document.getElementById("recipeModal")
  const modalBody = document.getElementById("modalBody")
  const modalTitle = document.getElementById("modalTitle")

  if (!modal || !modalBody) return

  modal.classList.add("active")
  modalBody.innerHTML = '<div class="loading"><div class="spinner"></div></div>'

  try {
    let recipe = appState.allRecipes.find((r) => r.id == recipeId)

    // Si pas trouvé dans allRecipes, chercher dans adminRecipes
    if (!recipe && source === "admin") {
      recipe = appState.adminRecipes.find((r) => r.id == recipeId)
    }

    // Si toujours pas trouvé, charger depuis l'API
    if (!recipe && source === "TheMealDB") {
      const response = await fetch(`${APIs.mealDB.base}${APIs.mealDB.endpoints.detail}${recipeId}`)
      const data = await response.json()
      if (data.meals?.[0]) {
        recipe = formatMealDBRecipe(data.meals[0])
      }
    }

    if (recipe) {
      modalTitle.textContent = recipe.title
      modalBody.innerHTML = buildRecipeDetailHTML(recipe)
    } else {
      modalBody.innerHTML = `
                <div class="error-message">
                    <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <h3>Recette introuvable</h3>
                    <p>Cette recette n'est plus disponible</p>
                </div>
            `
    }
  } catch (error) {
    console.error("Erreur lors du chargement de la recette:", error)
    modalBody.innerHTML = `
            <div class="error-message">
                <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <h3>Erreur de chargement</h3>
                <p>Impossible de charger les détails de la recette</p>
                <button class="btn btn-primary" onclick="showRecipeDetail('${recipeId}', '${source}')">
                    <i class="fas fa-redo"></i> Réessayer
                </button>
            </div>
        `
  }
}

function buildRecipeDetailHTML(recipe) {
  const nutritionHtml = buildNutritionHTML(recipe)
  const commentsHtml = buildCommentsHTML(recipe.id)

  return `
        <img src="${recipe.image}" alt="${recipe.title}" class="recipe-detail-image">
        
        <div class="recipe-detail-meta">
            <div class="meta-item">
                <div class="meta-value">${recipe.time}</div>
                <div class="meta-label">Minutes</div>
            </div>
            <div class="meta-item">
                <div class="meta-value">${recipe.difficulty}</div>
                <div class="meta-label">Difficulté</div>
            </div>
            <div class="meta-item">
                <div class="meta-value">${recipe.category}</div>
                <div class="meta-label">Catégorie</div>
            </div>
            <div class="meta-item">
                <div class="meta-value">${recipe.area}</div>
                <div class="meta-label">Origine</div>
            </div>
        </div>
        
        <div class="ingredients-list">
            <h3><i class="fas fa-list"></i> Ingrédients</h3>
            <ul>
                ${recipe.ingredients.map((ingredient) => `<li>${ingredient}</li>`).join("")}
            </ul>
        </div>
        
        <div class="instructions-list">
            <h3><i class="fas fa-clipboard-list"></i> Instructions</h3>
            <div class="instructions-content">
                ${formatInstructions(recipe.instructions)}
            </div>
        </div>
        
        ${nutritionHtml}
        
        ${
          recipe.youtube
            ? `
            <div class="video-section">
                <h3><i class="fab fa-youtube"></i> Vidéo de démonstration</h3>
                <a href="${recipe.youtube}" target="_blank" class="btn btn-primary">
                    <i class="fab fa-youtube"></i> Voir sur YouTube
                </a>
            </div>
        `
            : ""
        }
        
        ${commentsHtml}
        
        <div class="modal-actions" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
            ${
              appState.currentUser
                ? `
                <button class="btn btn-primary" onclick="toggleFavorite('${recipe.id}')">
                    <i class="fas fa-heart"></i>
                    ${appState.favorites.includes(recipe.id) ? "Retirer des favoris" : "Ajouter aux favoris"}
                </button>
            `
                : ""
            }
            <button class="btn btn-secondary" onclick="shareRecipe('${recipe.id}')">
                <i class="fas fa-share"></i> Partager
            </button>
        </div>
    `
}

function buildNutritionHTML(recipe) {
  if (appState.currentUser?.subscription !== "premium") {
    return `
            <div class="premium-feature">
                <h4><i class="fas fa-crown"></i> Informations nutritionnelles</h4>
                <p>Passez en Premium pour accéder aux informations nutritionnelles détaillées.</p>
                <button class="btn btn-premium" onclick="showSection('premium')">
                    <i class="fas fa-crown"></i> Découvrir Premium
                </button>
            </div>
        `
  }

  // Calcul approximatif des valeurs nutritionnelles
  const nutrition = calculateNutrition(recipe)

  return `
        <div class="nutrition-info">
            <h3><i class="fas fa-apple-alt"></i> Informations nutritionnelles</h3>
            <div class="nutrition-grid">
                <div class="nutrition-item">
                    <div class="nutrition-value">${nutrition.calories}</div>
                    <div class="nutrition-label">Calories</div>
                </div>
                <div class="nutrition-item">
                    <div class="nutrition-value">${nutrition.protein}g</div>
                    <div class="nutrition-label">Protéines</div>
                </div>
                <div class="nutrition-item">
                    <div class="nutrition-value">${nutrition.carbs}g</div>
                    <div class="nutrition-label">Glucides</div>
                </div>
                <div class="nutrition-item">
                    <div class="nutrition-value">${nutrition.fat}g</div>
                    <div class="nutrition-label">Lipides</div>
                </div>
            </div>
        </div>
    `
}

function calculateNutrition(recipe) {
  // Calcul approximatif basé sur la catégorie et les ingrédients
  const baseCalories = {
    breakfast: 300,
    lunch: 450,
    dinner: 550,
    dessert: 350,
    vegetarian: 400,
  }

  const calories = baseCalories[recipe.category] || 400

  return {
    calories: calories + Math.floor(Math.random() * 100),
    protein: Math.floor((calories * 0.15) / 4),
    carbs: Math.floor((calories * 0.55) / 4),
    fat: Math.floor((calories * 0.3) / 9),
  }
}

function formatInstructions(instructions) {
  if (!instructions) return "<p>Instructions non disponibles</p>"

  // Diviser les instructions en étapes
  const steps = instructions.split(/\d+\.|\n/).filter((step) => step.trim())

  if (steps.length > 1) {
    return `
            <ol>
                ${steps.map((step) => `<li>${step.trim()}</li>`).join("")}
            </ol>
        `
  }

  return `<p>${instructions.replace(/\n/g, "<br>")}</p>`
}

// =====================
// GESTION DES FAVORIS
// =====================
function toggleFavorite(recipeId, event = null) {
  if (event) {
    event.stopPropagation()
    event.preventDefault()
  }

  if (!appState.currentUser) {
    showToast("Connectez-vous pour ajouter des favoris", "info")
    showSection("login")
    return
  }

  const index = appState.favorites.indexOf(recipeId)

  if (index > -1) {
    appState.favorites.splice(index, 1)
    showToast("Retiré des favoris", "info")
  } else {
    appState.favorites.push(recipeId)
    showToast("Ajouté aux favoris", "success")
  }

  // Sauvegarder dans le localStorage
  localStorage.setItem("favorites", JSON.stringify(appState.favorites))

  // Mettre à jour l'affichage
  updateFavoritesDisplay()

  // Recharger les favoris si on est sur cette page
  if (document.getElementById("favorites")?.classList.contains("active")) {
    loadFavorites()
  }

  // Log de l'activité
  logActivity("favorite", `${index > -1 ? "Suppression" : "Ajout"} favori: ${recipeId}`)
}

function updateFavoritesDisplay() {
  document.querySelectorAll(".favorite-btn").forEach((btn) => {
    const onclickAttr = btn.getAttribute("onclick")
    if (onclickAttr) {
      const match = onclickAttr.match(/'([^']+)'/)
      if (match) {
        const recipeId = match[1]
        btn.classList.toggle("active", appState.favorites.includes(recipeId))
      }
    }
  })
}

function loadFavorites() {
  const container = document.getElementById("favoritesGrid")
  const noFavorites = document.getElementById("noFavorites")

  if (!container || !noFavorites) return

  if (!appState.favorites.length) {
    container.innerHTML = ""
    noFavorites.style.display = "block"
    return
  }

  noFavorites.style.display = "none"

  // Filtrer les recettes favorites
  const favoriteRecipes = appState.allRecipes.filter((recipe) => appState.favorites.includes(recipe.id))

  // Ajouter les recettes admin favorites
  const adminFavorites = appState.adminRecipes.filter((recipe) => appState.favorites.includes(recipe.id.toString()))

  favoriteRecipes.push(...adminFavorites)

  displayRecipes(favoriteRecipes, container)
}

// =====================
// RECHERCHE ET FILTRES
// =====================
function filterRecipes(category = null, resetOtherFilters = true) {
  console.log(`🔍 Filtrage par catégorie: ${category}`)

  // Si on réinitialise les autres filtres
  if (resetOtherFilters) {
    appState.filters = {
      category: category || "all",
      difficulty: "all",
      time: "all",
      area: "all",
      sort: appState.filters.sort,
    }
  } else if (category) {
    appState.filters.category = category
  }

  // Mettre à jour les boutons de filtre pour la catégorie
  document.querySelectorAll(".filter-btn").forEach((btn) => {
    btn.classList.remove("active")
  })

  const activeBtn = document.querySelector(`[onclick="filterRecipes('${appState.filters.category}')"]`)
  if (activeBtn) {
    activeBtn.classList.add("active")
  }

  // Mettre à jour l'interface des filtres
  updateFilterUI()

  // Appliquer tous les filtres
  applyFilters()
}

// Ajouter cette nouvelle fonction pour appliquer tous les filtres
function applyFilters() {
  const container = document.getElementById("recipesGrid")
  if (!container) return

  // Commencer avec toutes les recettes
  let filteredRecipes = [...appState.allRecipes]

  // Filtrer par catégorie
  if (appState.filters.category !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.category.toLowerCase() === appState.filters.category.toLowerCase(),
    )
  }

  // Filtrer par difficulté
  if (appState.filters.difficulty !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.difficulty.toLowerCase() === appState.filters.difficulty.toLowerCase(),
    )
  }

  // Filtrer par temps de préparation
  if (appState.filters.time !== "all") {
    const [min, max] = appState.filters.time.split("-").map(Number)
    filteredRecipes = filteredRecipes.filter((recipe) => recipe.time >= min && (max ? recipe.time <= max : true))
  }

  // Filtrer par origine
  if (appState.filters.area !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.area.toLowerCase() === appState.filters.area.toLowerCase(),
    )
  }

  // Trier les recettes
  sortRecipes(filteredRecipes)

  // Afficher les recettes filtrées
  displayRecipes(filteredRecipes, container)

  // Mettre à jour le compteur de résultats
  updateFilterResults(filteredRecipes.length)
}

// Ajouter cette fonction pour trier les recettes
function sortRecipes(recipes) {
  switch (appState.filters.sort) {
    case "name-asc":
      recipes.sort((a, b) => a.title.localeCompare(b.title))
      break
    case "name-desc":
      recipes.sort((a, b) => b.title.localeCompare(a.title))
      break
    case "time-asc":
      recipes.sort((a, b) => a.time - b.time)
      break
    case "time-desc":
      recipes.sort((a, b) => b.time - a.time)
      break
    case "difficulty-asc":
      const difficultyOrder = { facile: 1, moyen: 2, difficile: 3 }
      recipes.sort((a, b) => difficultyOrder[a.difficulty.toLowerCase()] - difficultyOrder[b.difficulty.toLowerCase()])
      break
    case "difficulty-desc":
      const difficultyOrderDesc = { facile: 3, moyen: 2, difficile: 1 }
      recipes.sort(
        (a, b) => difficultyOrderDesc[a.difficulty.toLowerCase()] - difficultyOrderDesc[b.difficulty.toLowerCase()],
      )
      break
    default:
      // Par défaut, ne rien faire
      break
  }
}

// Ajouter cette fonction pour mettre à jour l'interface des filtres
function updateFilterUI() {
  // Mettre à jour les sélecteurs de difficulté
  const difficultySelect = document.getElementById("filterDifficulty")
  if (difficultySelect) {
    difficultySelect.value = appState.filters.difficulty
  }

  // Mettre à jour les sélecteurs de temps
  const timeSelect = document.getElementById("filterTime")
  if (timeSelect) {
    timeSelect.value = appState.filters.time
  }

  // Mettre à jour les sélecteurs d'origine
  const areaSelect = document.getElementById("filterArea")
  if (areaSelect) {
    areaSelect.value = appState.filters.area
  }

  // Mettre à jour le sélecteur de tri
  const sortSelect = document.getElementById("sortRecipes")
  if (sortSelect) {
    sortSelect.value = appState.filters.sort
  }
}

// Ajouter cette fonction pour mettre à jour le compteur de résultats
function updateFilterResults(count) {
  const resultsCounter = document.getElementById("filterResults")
  if (resultsCounter) {
    resultsCounter.textContent = `${count} recette${count > 1 ? "s" : ""} trouvée${count > 1 ? "s" : ""}`
  }
}

// Ajouter cette fonction pour filtrer par difficulté
function filterByDifficulty(difficulty) {
  appState.filters.difficulty = difficulty
  applyFilters()
  updateFilterUI()
}

// Ajouter cette fonction pour filtrer par temps
function filterByTime(timeRange) {
  appState.filters.time = timeRange
  applyFilters()
  updateFilterUI()
}

// Ajouter cette fonction pour filtrer par origine
function filterByArea(area) {
  appState.filters.area = area
  applyFilters()
  updateFilterUI()
}

// Ajouter cette fonction pour trier les recettes
function sortRecipesList(sortBy) {
  appState.filters.sort = sortBy
  applyFilters()
  updateFilterUI()
}

// Ajouter cette fonction pour réinitialiser tous les filtres
function resetFilters() {
  appState.filters = {
    category: "all",
    difficulty: "all",
    time: "all",
    area: "all",
    sort: "default",
  }

  updateFilterUI()
  applyFilters()

  // Réinitialiser les boutons de catégorie
  document.querySelectorAll(".filter-btn").forEach((btn) => {
    btn.classList.remove("active")
  })

  const allBtn = document.querySelector(`[onclick="filterRecipes('all')"]`)
  if (allBtn) {
    allBtn.classList.add("active")
  }

  // Réinitialiser la recherche
  const searchInput = document.getElementById("searchInput")
  if (searchInput) {
    searchInput.value = ""
  }

  showToast("Filtres réinitialisés", "info")
}

// Modifier la fonction searchRecipes pour qu'elle fonctionne avec les filtres
function searchRecipes(query) {
  const normalized = query.toLowerCase().trim()

  if (normalized.length < 2) {
    applyFilters()
    return
  }

  console.log(`🔍 Recherche: ${normalized}`)

  // Appliquer d'abord les filtres actuels
  let filteredRecipes = [...appState.allRecipes]

  // Filtrer par catégorie
  if (appState.filters.category !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.category.toLowerCase() === appState.filters.category.toLowerCase(),
    )
  }

  // Filtrer par difficulté
  if (appState.filters.difficulty !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.difficulty.toLowerCase() === appState.filters.difficulty.toLowerCase(),
    )
  }

  // Filtrer par temps de préparation
  if (appState.filters.time !== "all") {
    const [min, max] = appState.filters.time.split("-").map(Number)
    filteredRecipes = filteredRecipes.filter((recipe) => recipe.time >= min && (max ? recipe.time <= max : true))
  }

  // Filtrer par origine
  if (appState.filters.area !== "all") {
    filteredRecipes = filteredRecipes.filter(
      (recipe) => recipe.area.toLowerCase() === appState.filters.area.toLowerCase(),
    )
  }

  // Ensuite, appliquer la recherche textuelle
  const results = filteredRecipes.filter(
    (recipe) =>
      recipe.title.toLowerCase().includes(normalized) ||
      recipe.description.toLowerCase().includes(normalized) ||
      recipe.ingredients.some((ingredient) => ingredient.toLowerCase().includes(normalized)) ||
      recipe.area.toLowerCase().includes(normalized),
  )

  // Trier les résultats
  sortRecipes(results)

  const container = document.getElementById("recipesGrid")
  if (container) {
    displayRecipes(results, container)
    updateFilterResults(results.length)
  }
}

// Ajouter cette fonction pour initialiser les filtres
function initFilters() {
  // Créer les sélecteurs de filtres s'ils n'existent pas
  const filtersContainer = document.getElementById("filtersContainer")
  if (!filtersContainer) return

  // Récupérer les valeurs uniques pour les filtres
  const difficulties = [...new Set(appState.allRecipes.map((r) => r.difficulty.toLowerCase()))]
  const areas = [...new Set(appState.allRecipes.map((r) => r.area))]

  // Créer le HTML des filtres
  filtersContainer.innerHTML = `
    <div class="filters-row">
      <div class="filter-group">
        <label for="filterDifficulty">Difficulté</label>
        <select id="filterDifficulty" onchange="filterByDifficulty(this.value)">
          <option value="all">Toutes</option>
          ${difficulties.map((d) => `<option value="${d}">${d.charAt(0).toUpperCase() + d.slice(1)}</option>`).join("")}
        </select>
      </div>
      
      <div class="filter-group">
        <label for="filterTime">Temps</label>
        <select id="filterTime" onchange="filterByTime(this.value)">
          <option value="all">Tous</option>
          <option value="0-15">Rapide (< 15 min)</option>
          <option value="15-30">Moyen (15-30 min)</option>
          <option value="30-60">Long (30-60 min)</option>
          <option value="60">Très long (> 60 min)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="filterArea">Origine</label>
        <select id="filterArea" onchange="filterByArea(this.value)">
          <option value="all">Toutes</option>
          ${areas.map((a) => `<option value="${a.toLowerCase()}">${a}</option>`).join("")}
        </select>
      </div>
      
      <div class="filter-group">
        <label for="sortRecipes">Trier par</label>
        <select id="sortRecipes" onchange="sortRecipesList(this.value)">
          <option value="default">Par défaut</option>
          <option value="name-asc">Nom (A-Z)</option>
          <option value="name-desc">Nom (Z-A)</option>
          <option value="time-asc">Temps (croissant)</option>
          <option value="time-desc">Temps (décroissant)</option>
          <option value="difficulty-asc">Difficulté (facile à difficile)</option>
          <option value="difficulty-desc">Difficulté (difficile à facile)</option>
        </select>
      </div>
    </div>
    
    <div class="filters-actions">
      <button class="btn btn-outline" onclick="resetFilters()">
        <i class="fas fa-redo"></i> Réinitialiser les filtres
      </button>
      <span id="filterResults" class="filter-results">
        ${appState.allRecipes.length} recettes trouvées
      </span>
    </div>
  `
}

// Modifier la fonction loadRecipes pour initialiser les filtres après le chargement
async function loadRecipes() {
  const container = document.getElementById("recipesGrid")
  const loading = document.getElementById("loading")
  const errorMessage = document.getElementById("errorMessage")

  if (!container) return

  // Afficher le loading
  if (loading) loading.style.display = "block"
  if (errorMessage) errorMessage.style.display = "none"
  container.innerHTML = ""

  try {
    const recipes = []
    const categories = ["Chicken", "Beef", "Seafood", "Vegetarian", "Pasta", "Dessert"]

    // Charger des recettes par catégorie
    for (const category of categories) {
      try {
        const response = await fetch(`${APIs.mealDB.base}/filter.php?c=${category}`)
        const data = await response.json()

        if (data.meals) {
          const categoryRecipes = data.meals.slice(0, 3).map((meal) => formatMealDBRecipe(meal))
          recipes.push(...categoryRecipes)
        }
      } catch (error) {
        console.warn(`Erreur pour la catégorie ${category}:`, error)
      }
    }

    // Ajouter les recettes admin
    recipes.push(...appState.adminRecipes)

    // Sauvegarder dans l'état
    appState.allRecipes = recipes

    // Initialiser les filtres
    initFilters()

    // Afficher les recettes
    displayRecipes(recipes, container)
    updateFilterResults(recipes.length)
  } catch (error) {
    console.error("Erreur lors du chargement des recettes:", error)
    if (errorMessage) errorMessage.style.display = "block"
  } finally {
    if (loading) loading.style.display = "none"
  }
}

// Ajouter ces fonctions à l'export global
window.filterByDifficulty = filterByDifficulty
window.filterByTime = filterByTime
window.filterByArea = filterByArea
window.sortRecipesList = sortRecipesList
window.resetFilters = resetFilters
window.initFilters = initFilters

// Ajouter des styles CSS pour les filtres
const filterStyles = `
  .filters-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .filter-group {
    display: flex;
    flex-direction: column;
    min-width: 150px;
    flex: 1;
  }
  
  .filter-group label {
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
    color: var(--gray);
  }
  
  .filter-group select {
    padding: 0.5rem;
    border-radius: var(--border-radius);
    border: 1px solid #ddd;
    background: white;
  }
  
  .dark-mode .filter-group select {
    background: var(--dark-color);
    border-color: #444;
    color: var(--text-dark);
  }
  
  .filters-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .filter-results {
    font-size: 0.9rem;
    color: var(--gray);
  }
  
  .dark-mode .filter-results {
    color: #a0a0c0;
  }
  
  @media (max-width: 768px) {
    .filters-row {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .filters-actions {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }
  }
`

// Ajouter les styles de filtrage au styleSheet existant
styleSheet.textContent += filterStyles

// =====================
// COMMENTAIRES
// =====================
function buildCommentsHTML(recipeId) {
  const comments = appState.comments.filter((c) => c.recipeId == recipeId)

  let html = `
        <div class="comments-section">
            <h3><i class="fas fa-comments"></i> Commentaires (${comments.length})</h3>
    `

  if (comments.length > 0) {
    html += '<div class="comments-list">'
    comments.forEach((comment) => {
      const user = appState.users.find((u) => u.id === comment.userId)
      html += `
                <div class="comment">
                    <div class="comment-header">
                        <strong>${user?.name || "Utilisateur supprimé"}</strong>
                        <span>${comment.date}</span>
                    </div>
                    <p>${comment.text}</p>
                </div>
            `
    })
    html += "</div>"
  } else {
    html += "<p>Aucun commentaire pour le moment. Soyez le premier à commenter !</p>"
  }

  if (appState.currentUser) {
    html += `
            <div class="add-comment">
                <h4>Ajouter un commentaire</h4>
                <textarea id="newComment-${recipeId}" 
                         placeholder="Partagez votre avis sur cette recette..." 
                         rows="3" 
                         class="ajouter-com"></textarea>
                <button class="btn btn-primary" onclick="addComment('${recipeId}')">
                    <i class="fas fa-paper-plane"></i> Publier
                </button>
            </div>
        `
  } else {
    html += '<p><a href="#" onclick="showSection(\'login\')">Connectez-vous</a> pour laisser un commentaire.</p>'
  }

  html += "</div>"
  return html
}

function addComment(recipeId) {
  if (!appState.currentUser) {
    showToast("Connectez-vous pour commenter", "info")
    return
  }

  const textarea = document.getElementById(`newComment-${recipeId}`)
  if (!textarea) return

  const text = textarea.value.trim()

  if (!text) {
    showToast("Veuillez saisir un commentaire", "error")
    return
  }

  if (text.length < 5) {
    showToast("Le commentaire doit contenir au moins 5 caractères", "error")
    return
  }

  // Ajouter le commentaire
  const newComment = {
    id: Date.now(),
    recipeId: recipeId,
    userId: appState.currentUser.id,
    text: text,
    date: new Date().toLocaleDateString("fr-FR"),
  }

  appState.comments.push(newComment)

  // Vider le textarea
  textarea.value = ""

  // Recharger les commentaires dans la modal
  const modalBody = document.getElementById("modalBody")
  if (modalBody) {
    const recipe =
      appState.allRecipes.find((r) => r.id == recipeId) || appState.adminRecipes.find((r) => r.id == recipeId)
    if (recipe) {
      modalBody.innerHTML = buildRecipeDetailHTML(recipe)
    }
  }

  logActivity("comment", `Commentaire ajouté sur recette ${recipeId}`)
  showToast("Commentaire ajouté avec succès", "success")
}

// =====================
// PLANIFICATEUR DE REPAS
// =====================
async function generateMealPlan() {
  if (!hasPremiumAccess()) {
    showToast("Fonctionnalité réservée aux abonnés Premium", "warning")
    showSection("premium")
    return
  }

  const days = document.getElementById("mealDays")?.value || 7
  const diet = document.getElementById("mealDiet")?.value || ""
  const calories = document.getElementById("mealCalories")?.value || 2000

  const container = document.getElementById("mealPlanResult")
  if (!container) return

  container.innerHTML =
    '<div class="loading"><div class="spinner"></div><p>Génération de votre plan de repas...</p></div>'
  container.style.display = "block"

  try {
    // Simuler un appel API (remplacer par un vrai appel si nécessaire)
    await new Promise((resolve) => setTimeout(resolve, 2000))

    const mealPlan = generateMockMealPlan(days, diet, calories)
    container.innerHTML = buildMealPlanHTML(mealPlan)

    logActivity("meal_plan", `Plan de repas généré pour ${days} jours`)
    showToast("Plan de repas généré avec succès !", "success")
  } catch (error) {
    console.error("Erreur lors de la génération du plan de repas:", error)
    container.innerHTML = `
            <div class="error-message">
                <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <h3>Erreur de génération</h3>
                <p>Impossible de générer le plan de repas. Réessayez plus tard.</p>
                <button class="btn btn-primary" onclick="generateMealPlan()">
                    <i class="fas fa-redo"></i> Réessayer
                </button>
            </div>
        `
  }
}

function generateMockMealPlan(days, diet, targetCalories) {
  const daysOfWeek = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"]
  const mealTypes = ["Petit-déjeuner", "Déjeuner", "Dîner"]

  const mealPlan = {
    days: [],
    totalCalories: 0,
    averageCalories: 0,
  }

  for (let i = 0; i < days; i++) {
    const dayName = daysOfWeek[i % 7]
    const dayMeals = []
    let dayCalories = 0

    mealTypes.forEach((mealType) => {
      const meal = generateMockMeal(mealType, diet)
      dayMeals.push(meal)
      dayCalories += meal.calories
    })

    mealPlan.days.push({
      name: dayName,
      date: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toLocaleDateString("fr-FR"),
      meals: dayMeals,
      totalCalories: dayCalories,
    })

    mealPlan.totalCalories += dayCalories
  }

  mealPlan.averageCalories = Math.round(mealPlan.totalCalories / days)

  return mealPlan
}

function generateMockMeal(mealType, diet) {
  const meals = {
    "Petit-déjeuner": [
      { name: "Avoine aux fruits", calories: 320, time: 10 },
      { name: "Œufs brouillés au pain complet", calories: 380, time: 15 },
      { name: "Smoothie protéiné", calories: 290, time: 5 },
      { name: "Pancakes aux myrtilles", calories: 420, time: 20 },
    ],
    Déjeuner: [
      { name: "Salade de quinoa aux légumes", calories: 450, time: 25 },
      { name: "Saumon grillé aux légumes verts", calories: 520, time: 30 },
      { name: "Wrap au poulet et avocat", calories: 480, time: 15 },
      { name: "Soupe de lentilles maison", calories: 380, time: 35 },
    ],
    Dîner: [
      { name: "Poisson blanc aux légumes rôtis", calories: 420, time: 40 },
      { name: "Curry de légumes au lait de coco", calories: 390, time: 30 },
      { name: "Escalope de dinde aux champignons", calories: 460, time: 25 },
      { name: "Risotto aux légumes de saison", calories: 440, time: 35 },
    ],
  }

  const mealOptions = meals[mealType] || meals["Déjeuner"]
  const selectedMeal = mealOptions[Math.floor(Math.random() * mealOptions.length)]

  return {
    ...selectedMeal,
    type: mealType,
    difficulty: ["Facile", "Moyen"][Math.floor(Math.random() * 2)],
  }
}

function buildMealPlanHTML(mealPlan) {
  return `
        <div class="meal-plan-result">
            <div class="meal-plan-header">
                <h3><i class="fas fa-calendar-alt"></i> Votre plan de repas</h3>
                <div class="meal-plan-actions">
                    <button class="btn btn-secondary" onclick="exportMealPlan()">
                        <i class="fas fa-download"></i> Exporter
                    </button>
                    <button class="btn btn-outline" onclick="generateMealPlan()">
                        <i class="fas fa-redo"></i> Régénérer
                    </button>
                </div>
            </div>
            
            ${mealPlan.days
              .map(
                (day) => `
                <div class="meal-plan-day">
                    <div class="day-header">
                        <h4><i class="fas fa-calendar-day"></i> ${day.name}</h4>
                        <span class="day-date">${day.date}</span>
                    </div>
                    
                    <div class="meals-container">
                        ${day.meals
                          .map(
                            (meal) => `
                            <div class="meal-card">
                                <div class="meal-time">
                                    <i class="fas fa-clock"></i> ${meal.type}
                                </div>
                                <div class="meal-content">
                                    <h5 class="meal-title">${meal.name}</h5>
                                    <div class="meal-meta">
                                        <div class="meal-meta-item">
                                            <i class="fas fa-fire"></i> ${meal.calories} cal
                                        </div>
                                        <div class="meal-meta-item">
                                            <i class="fas fa-clock"></i> ${meal.time} min
                                        </div>
                                        <div class="meal-meta-item">
                                            <i class="fas fa-chart-line"></i> ${meal.difficulty}
                                        </div>
                                    </div>
                                    <div class="meal-actions">
                                        <button class="btn btn-outline btn-sm" onclick="searchSimilarRecipe('${meal.name}')">
                                            <i class="fas fa-search"></i> Trouver recette
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `,
                          )
                          .join("")}
                    </div>
                    
                    <div class="nutrition-summary">
                        <div class="nutrition-item">
                            <div class="nutrition-value">${day.totalCalories}</div>
                            <div class="nutrition-label">Calories totales</div>
                        </div>
                    </div>
                </div>
            `,
              )
              .join("")}
            
            <div class="meal-plan-footer">
                <div class="meal-plan-calories">
                    <i class="fas fa-chart-pie"></i>
                    <span>Moyenne: ${mealPlan.averageCalories} calories/jour</span>
                </div>
                <div class="meal-plan-buttons">
                    <button class="btn btn-premium" onclick="saveMealPlan()">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                    <button class="btn btn-secondary" onclick="shareMealPlan()">
                        <i class="fas fa-share"></i> Partager
                    </button>
                </div>
            </div>
        </div>
    `
}

function searchSimilarRecipe(mealName) {
  showSection("recipes")
  const searchInput = document.getElementById("searchInput")
  if (searchInput) {
    searchInput.value = mealName
    searchRecipes(mealName)
  }
}

function exportMealPlan() {
  showToast("Fonctionnalité d'export en cours de développement", "info")
}

function saveMealPlan() {
  showToast("Plan de repas sauvegardé dans vos favoris", "success")
}

function shareMealPlan() {
  if (navigator.share) {
    navigator.share({
      title: "Mon plan de repas RecipeHub",
      text: "Découvrez mon plan de repas personnalisé",
      url: window.location.href,
    })
  } else {
    navigator.clipboard.writeText(window.location.href)
    showToast("Lien copié dans le presse-papiers", "success")
  }
}

// =====================
// GESTION DES ABONNEMENTS
// =====================
function loadSubscriptionInfo() {
  const container = document.getElementById("subscriptionInfo")
  const paymentHistory = document.getElementById("paymentHistory")

  if (!container || !paymentHistory || !appState.currentUser) return

  const subscription = appState.subscriptions.find((s) => s.userId === appState.currentUser.id)

  if (subscription && appState.currentUser.subscription === "premium") {
    container.innerHTML = `
            <div class="subscription-card" style="background: var(--gradient-premium); color: white; padding: 2rem; border-radius: var(--border-radius); margin-bottom: 2rem;">
                <div class="subscription-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-crown"></i> Abonnement Premium
                        </h3>
                        <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">
                            Actif jusqu'au ${subscription.endDate}
                        </p>
                    </div>
                    <span class="badge" style="background: rgba(255,255,255,0.2); color: white; padding: 0.5rem 1rem;">
                        <i class="fas fa-check-circle"></i> Actif
                    </span>
                </div>
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-outline" style="border-color: white; color: white;" onclick="cancelSubscription()">
                        <i class="fas fa-times"></i> Annuler l'abonnement
                    </button>
                </div>
            </div>
        `

    paymentHistory.innerHTML = `
            <tr>
                <td>${subscription.startDate}</td>
                <td>€4.99</td>
                <td><i class="fas fa-credit-card"></i> Carte de crédit</td>
                <td><span style="color: var(--success);"><i class="fas fa-check-circle"></i> Réussi</span></td>
            </tr>
        `
  } else {
    container.innerHTML = `
            <div class="subscription-card" style="background: var(--light-color); padding: 2rem; border-radius: var(--border-radius); text-align: center; margin-bottom: 2rem;">
                <h3><i class="fas fa-user"></i> Abonnement Gratuit</h3>
                <p style="color: var(--gray); margin: 1rem 0;">
                    Vous utilisez actuellement la version gratuite de RecipeHub
                </p>
                <button class="btn btn-premium" onclick="initiatePayment()">
                    <i class="fas fa-crown"></i> Passer en Premium - €4.99/mois
                </button>
            </div>
        `

    paymentHistory.innerHTML =
      '<tr><td colspan="4" style="text-align: center; color: var(--gray);">Aucun historique de paiement</td></tr>'
  }
}

function initiatePayment() {
  if (!appState.currentUser) {
    showSection("login")
    showToast("Connectez-vous pour souscrire à Premium", "info")
    return
  }

  showSection("payment")
}

function processPayment() {
  const cardNumber = document.getElementById("cardNumber")?.value?.trim()
  const cardExpiry = document.getElementById("cardExpiry")?.value?.trim()
  const cardCvv = document.getElementById("cardCvv")?.value?.trim()
  const cardName = document.getElementById("cardName")?.value?.trim()

  // Validation
  if (!cardNumber || !cardExpiry || !cardCvv || !cardName) {
    showToast("Veuillez remplir tous les champs", "error")
    return
  }

  if (cardNumber.length < 16) {
    showToast("Numéro de carte invalide", "error")
    return
  }

  if (cardCvv.length < 3) {
    showToast("CVV invalide", "error")
    return
  }

  // Simulation du traitement du paiement
  showToast("Traitement du paiement en cours...", "info")

  setTimeout(() => {
    // Mettre à jour l'utilisateur
    const userIndex = appState.users.findIndex((u) => u.id === appState.currentUser.id)
    if (userIndex !== -1) {
      const expirationDate = new Date()
      expirationDate.setFullYear(expirationDate.getFullYear() + 1)

      appState.users[userIndex].subscription = "premium"
      appState.users[userIndex].expiration = expirationDate.toISOString().split("T")[0]

      appState.currentUser = appState.users[userIndex]
      localStorage.setItem("currentUser", JSON.stringify(appState.currentUser))

      // Ajouter l'abonnement
      appState.subscriptions.push({
        id: appState.subscriptions.length + 1,
        userId: appState.currentUser.id,
        type: "premium",
        startDate: new Date().toISOString().split("T")[0],
        endDate: appState.users[userIndex].expiration,
        status: "active",
      })

      logActivity("subscription", `Souscription Premium de ${appState.currentUser.name}`)
      showSection("paymentSuccess")
      initUI()
    }
  }, 2000)
}

function cancelSubscription() {
  if (!confirm("Êtes-vous sûr de vouloir annuler votre abonnement Premium ?")) {
    return
  }

  const userIndex = appState.users.findIndex((u) => u.id === appState.currentUser.id)
  if (userIndex !== -1) {
    appState.users[userIndex].subscription = "free"
    appState.users[userIndex].expiration = null

    appState.currentUser = appState.users[userIndex]
    localStorage.setItem("currentUser", JSON.stringify(appState.currentUser))

    // Supprimer l'abonnement
    appState.subscriptions = appState.subscriptions.filter((s) => s.userId !== appState.currentUser.id)

    logActivity("subscription_cancel", `Annulation Premium de ${appState.currentUser.name}`)
    showToast("Abonnement annulé avec succès", "success")
    initUI()
    loadSubscriptionInfo()
  }
}

// =====================
// FONCTIONS ADMIN
// =====================
function initAdminDashboard() {
  updateAdminStats()
  loadAdminUsers()
  loadAdminRecipes()
  loadAdminCategories()
  loadAdminSubscriptions()
  loadAdminComments()
}

function updateAdminStats() {
  const elements = {
    adminUsersCount: appState.users.length,
    adminPremiumCount: appState.users.filter((u) => u.subscription === "premium").length,
    adminRecipesCount: appState.adminRecipes.length,
    adminCommentsCount: appState.comments.length,
  }

  Object.entries(elements).forEach(([id, value]) => {
    const element = document.getElementById(id)
    if (element) element.textContent = value
  })
}

function showAdminSection(sectionId) {
  // Masquer toutes les sections admin
  document.querySelectorAll(".admin-section").forEach((section) => {
    section.style.display = "none"
  })

  // Afficher la section demandée
  const targetSection = document.getElementById("admin-" + sectionId)
  if (targetSection) {
    targetSection.style.display = "block"
  }

  // Mettre à jour la navigation
  document.querySelectorAll(".admin-nav a").forEach((link) => {
    link.classList.remove("active")
  })

  const activeLink = document.querySelector(`.admin-nav a[onclick="showAdminSection('${sectionId}')"]`)
  if (activeLink) {
    activeLink.classList.add("active")
  }

  // Charger les données spécifiques
  const loaders = {
    dashboard: updateAdminStats,
    users: loadAdminUsers,
    recipes: loadAdminRecipes,
    categories: loadAdminCategories,
    subscriptions: loadAdminSubscriptions,
    comments: loadAdminComments,
  }

  if (loaders[sectionId]) {
    loaders[sectionId]()
  }
}

function loadAdminUsers() {
  const container = document.getElementById("adminUsersList")
  if (!container) return

  container.innerHTML = appState.users
    .map(
      (user) => `
        <tr>
            <td>${user.id}</td>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>
                <span class="badge ${user.role === "admin" ? "badge-warning" : "badge-info"}">
                    ${user.role}
                </span>
            </td>
            <td>
                <span class="badge ${user.subscription === "premium" ? "badge-success" : "badge-secondary"}">
                    ${user.subscription}
                </span>
            </td>
            <td>
                <button class="btn btn-outline btn-sm" onclick="showUserForm(${user.id})" title="Modifier">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline btn-sm" onclick="deleteUser(${user.id})" title="Supprimer">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="btn btn-outline btn-sm" onclick="toggleUserStatus(${user.id})" title="Activer/Désactiver">
                    <i class="fas fa-${user.active !== false ? "ban" : "check"}"></i>
                </button>
            </td>
        </tr>
    `,
    )
    .join("")
}

function showUserForm(userId = null) {
  const container = document.getElementById("userFormContainer")
  const title = document.getElementById("userFormTitle")

  if (!container || !title) return

  resetUserForm()

  if (userId) {
    const user = appState.users.find((u) => u.id == userId)
    if (user) {
      title.textContent = `Modifier l'utilisateur: ${user.name}`
      document.getElementById("userName").value = user.name
      document.getElementById("userEmail").value = user.email
      document.getElementById("userRole").value = user.role
      document.getElementById("userSubscription").value = user.subscription
      document.getElementById("saveUserBtn").setAttribute("data-user-id", userId)
    }
  } else {
    title.textContent = "Ajouter un nouvel utilisateur"
    document.getElementById("saveUserBtn").removeAttribute("data-user-id")
  }

  container.style.display = "block"
}

function saveUser() {
  const name = document.getElementById("userName").value.trim()
  const email = document.getElementById("userEmail").value.trim()
  const role = document.getElementById("userRole").value
  const subscription = document.getElementById("userSubscription").value
  const password = document.getElementById("userPassword").value
  const userId = document.getElementById("saveUserBtn").getAttribute("data-user-id")

  if (!name || !email) {
    showToast("Le nom et l'email sont obligatoires", "error")
    return
  }

  if (!isValidEmail(email)) {
    showToast("Format d'email invalide", "error")
    return
  }

  const existingUser = appState.users.find((u) => u.email === email && u.id != userId)
  if (existingUser) {
    showToast("Cet email est déjà utilisé", "error")
    return
  }

  if (userId) {
    const userIndex = appState.users.findIndex((u) => u.id == userId)
    if (userIndex !== -1) {
      appState.users[userIndex] = {
        ...appState.users[userIndex],
        name,
        email,
        role,
        subscription,
        ...(password && { password }),
        updatedAt: new Date().toISOString(),
      }

      if (appState.currentUser && appState.currentUser.id == userId) {
        appState.currentUser = appState.users[userIndex]
        localStorage.setItem("currentUser", JSON.stringify(appState.currentUser))
      }

      showToast("Utilisateur mis à jour avec succès", "success")
    }
  } else {
    if (!password) {
      showToast("Le mot de passe est obligatoire pour un nouvel utilisateur", "error")
      return
    }

    const newUser = {
      id: Math.max(...appState.users.map((u) => u.id), 0) + 1,
      name,
      email,
      password,
      role,
      subscription,
      active: true,
      createdAt: new Date().toISOString(),
      expiration:
        subscription === "premium"
          ? new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString().split("T")[0]
          : null,
    }

    appState.users.push(newUser)
    showToast("Utilisateur créé avec succès", "success")
  }

  loadAdminUsers()
  updateAdminStats()
  cancelUserForm()
}

function deleteUser(userId) {
  if (!confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ?")) return

  const userIndex = appState.users.findIndex((u) => u.id == userId)
  if (userIndex !== -1) {
    const user = appState.users[userIndex]

    if (user.role === "admin" && user.id === 1) {
      showToast("Impossible de supprimer l'administrateur principal", "error")
      return
    }

    appState.users.splice(userIndex, 1)
    appState.comments = appState.comments.filter((c) => c.userId != userId)
    appState.subscriptions = appState.subscriptions.filter((s) => s.userId != userId)

    showToast("Utilisateur supprimé avec succès", "success")
    loadAdminUsers()
    updateAdminStats()
  }
}

function toggleUserStatus(userId) {
  const userIndex = appState.users.findIndex((u) => u.id == userId)
  if (userIndex !== -1) {
    appState.users[userIndex].active = !appState.users[userIndex].active
    const status = appState.users[userIndex].active ? "activé" : "désactivé"
    showToast(`Utilisateur ${status}`, "success")
    loadAdminUsers()
  }
}

function cancelUserForm() {
  const container = document.getElementById("userFormContainer")
  if (container) {
    container.style.display = "none"
    resetUserForm()
  }
}

function resetUserForm() {
  const fields = ["userName", "userEmail", "userPassword"]
  fields.forEach((fieldId) => {
    const field = document.getElementById(fieldId)
    if (field) field.value = ""
  })

  const roleField = document.getElementById("userRole")
  const subscriptionField = document.getElementById("userSubscription")

  if (roleField) roleField.value = "user"
  if (subscriptionField) subscriptionField.value = "free"
}

function loadAdminRecipes() {
  const container = document.getElementById("adminRecipesList")
  if (!container) return

  container.innerHTML = appState.adminRecipes
    .map(
      (recipe) => `
        <tr>
            <td>${recipe.id}</td>
            <td>${recipe.title}</td>
            <td>
                <span class="badge badge-info">${recipe.category}</span>
            </td>
            <td>
                <span class="difficulty-${recipe.difficulty?.toLowerCase() || "easy"}">
                    ${recipe.difficulty || "Facile"}
                </span>
            </td>
            <td>${recipe.time || 30} min</td>
            <td>
                <button class="btn btn-outline btn-sm" onclick="showRecipeForm(${recipe.id})" title="Modifier">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline btn-sm" onclick="deleteRecipe(${recipe.id})" title="Supprimer">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="btn btn-outline btn-sm" onclick="previewRecipe(${recipe.id})" title="Aperçu">
                    <i class="fas fa-eye"></i>
                </button>
            </td>
        </tr>
    `,
    )
    .join("")
}

function showRecipeForm(recipeId = null) {
  const container = document.getElementById("recipeFormContainer")
  const title = document.getElementById("recipeFormTitle")

  if (!container || !title) return

  resetRecipeForm()

  if (recipeId) {
    const recipe = appState.adminRecipes.find((r) => r.id == recipeId)
    if (recipe) {
      title.textContent = `Modifier la recette: ${recipe.title}`

      document.getElementById("recipeName").value = recipe.title || ""
      document.getElementById("recipeCategory").value = recipe.category || "breakfast"
      document.getElementById("recipeDifficulty").value = recipe.difficulty || "easy"
      document.getElementById("recipeTime").value = recipe.time || 30
      document.getElementById("recipeImage").value = recipe.image || ""
      document.getElementById("recipeInstructions").value = recipe.instructions || ""
      document.getElementById("recipeVideo").value = recipe.youtube || ""

      const ingredientsContainer = document.getElementById("ingredientsContainer")
      ingredientsContainer.innerHTML = ""

      if (recipe.ingredients && recipe.ingredients.length > 0) {
        recipe.ingredients.forEach((ingredient) => addIngredient(ingredient))
      } else {
        addIngredient()
      }

      document.getElementById("saveRecipeBtn").setAttribute("data-recipe-id", recipeId)
    }
  } else {
    title.textContent = "Ajouter une nouvelle recette"
    document.getElementById("saveRecipeBtn").removeAttribute("data-recipe-id")
    addIngredient()
  }

  container.style.display = "block"
}

function saveRecipe() {
  const name = document.getElementById("recipeName").value.trim()
  const category = document.getElementById("recipeCategory").value
  const difficulty = document.getElementById("recipeDifficulty").value
  const time = Number.parseInt(document.getElementById("recipeTime").value) || 30
  const image = document.getElementById("recipeImage").value.trim()
  const instructions = document.getElementById("recipeInstructions").value.trim()
  const video = document.getElementById("recipeVideo").value.trim()
  const recipeId = document.getElementById("saveRecipeBtn").getAttribute("data-recipe-id")

  const ingredients = []
  document.querySelectorAll("#ingredientsContainer input").forEach((input) => {
    const value = input.value.trim()
    if (value) ingredients.push(value)
  })

  if (!name) {
    showToast("Le nom de la recette est obligatoire", "error")
    return
  }

  if (ingredients.length === 0) {
    showToast("Au moins un ingrédient est requis", "error")
    return
  }

  if (!instructions) {
    showToast("Les instructions sont obligatoires", "error")
    return
  }

  const recipeData = {
    title: name,
    category,
    difficulty,
    time,
    image: image || "/placeholder.svg?height=200&width=300",
    instructions,
    ingredients,
    youtube: video || undefined,
    source: "admin",
    description: instructions.substring(0, 150) + "...",
    area: "Maison",
    updatedAt: new Date().toISOString(),
  }

  if (recipeId) {
    const recipeIndex = appState.adminRecipes.findIndex((r) => r.id == recipeId)
    if (recipeIndex !== -1) {
      appState.adminRecipes[recipeIndex] = {
        ...appState.adminRecipes[recipeIndex],
        ...recipeData,
      }
      showToast("Recette mise à jour avec succès", "success")
    }
  } else {
    const newRecipe = {
      id: Date.now(),
      ...recipeData,
      createdAt: new Date().toISOString(),
    }

    appState.adminRecipes.push(newRecipe)
    showToast("Recette créée avec succès", "success")
  }

  loadAdminRecipes()
  updateAdminStats()

  if (document.getElementById("recipes").classList.contains("active")) {
    loadRecipes()
  }

  cancelRecipeForm()
}

function deleteRecipe(recipeId) {
  if (!confirm("Êtes-vous sûr de vouloir supprimer cette recette ?")) return

  const recipeIndex = appState.adminRecipes.findIndex((r) => r.id == recipeId)
  if (recipeIndex !== -1) {
    appState.adminRecipes.splice(recipeIndex, 1)
    appState.comments = appState.comments.filter((c) => c.recipeId != recipeId)

    showToast("Recette supprimée avec succès", "success")
    loadAdminRecipes()
    updateAdminStats()

    if (document.getElementById("recipes").classList.contains("active")) {
      loadRecipes()
    }
  }
}

function previewRecipe(recipeId) {
  const recipe = appState.adminRecipes.find((r) => r.id == recipeId)
  if (recipe) {
    showRecipeDetail(recipeId, "admin")
  }
}

function cancelRecipeForm() {
  const container = document.getElementById("recipeFormContainer")
  if (container) {
    container.style.display = "none"
    resetRecipeForm()
  }
}

function resetRecipeForm() {
  const fields = ["recipeName", "recipeImage", "recipeInstructions", "recipeVideo"]
  fields.forEach((fieldId) => {
    const field = document.getElementById(fieldId)
    if (field) field.value = ""
  })

  const categoryField = document.getElementById("recipeCategory")
  const difficultyField = document.getElementById("recipeDifficulty")
  const timeField = document.getElementById("recipeTime")

  if (categoryField) categoryField.value = "breakfast"
  if (difficultyField) difficultyField.value = "easy"
  if (timeField) timeField.value = "30"

  const ingredientsContainer = document.getElementById("ingredientsContainer")
  if (ingredientsContainer) {
    ingredientsContainer.innerHTML = ""
  }
}

function addIngredient(value = "") {
  const container = document.getElementById("ingredientsContainer")
  if (!container) return

  const div = document.createElement("div")
  div.className = "ingredient-item"
  div.innerHTML = `
        <input type="text" placeholder="Ex: 200g de farine" value="${value}">
        <button type="button" class="btn btn-outline btn-sm" onclick="removeIngredient(this)" title="Supprimer">
            <i class="fas fa-minus"></i>
        </button>
    `
  container.appendChild(div)
}

function removeIngredient(button) {
  const container = document.getElementById("ingredientsContainer")
  if (container && container.children.length > 1) {
    button.parentElement.remove()
  } else {
    showToast("Au moins un ingrédient est requis", "warning")
  }
}

function loadAdminCategories() {
  const container = document.getElementById("adminCategoriesList")
  if (!container) return

  appState.categories.forEach((category) => {
    category.recipeCount = appState.adminRecipes.filter((r) => r.category === category.id).length
  })

  container.innerHTML = appState.categories
    .map(
      (category) => `
        <tr>
            <td>${category.id}</td>
            <td>${category.name}</td>
            <td>${category.recipeCount}</td>
            <td>
                <button class="btn btn-outline btn-sm" onclick="showCategoryForm('${category.id}')" title="Modifier">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline btn-sm" onclick="deleteCategory('${category.id}')" title="Supprimer">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `,
    )
    .join("")
}

function showCategoryForm(categoryId = null) {
  const container = document.getElementById("categoryFormContainer")
  const title = document.getElementById("categoryFormTitle")

  if (!container || !title) return

  resetCategoryForm()

  if (categoryId) {
    const category = appState.categories.find((c) => c.id === categoryId)
    if (category) {
      title.textContent = `Modifier la catégorie: ${category.name}`
      document.getElementById("categoryName").value = category.name
      document.getElementById("categoryDescription").value = category.description || ""
      document.getElementById("saveCategoryBtn").setAttribute("data-category-id", categoryId)
    }
  } else {
    title.textContent = "Ajouter une nouvelle catégorie"
    document.getElementById("saveCategoryBtn").removeAttribute("data-category-id")
  }

  container.style.display = "block"
}

function saveCategory() {
  const name = document.getElementById("categoryName").value.trim()
  const description = document.getElementById("categoryDescription").value.trim()
  const categoryId = document.getElementById("saveCategoryBtn").getAttribute("data-category-id")

  if (!name) {
    showToast("Le nom de la catégorie est obligatoire", "error")
    return
  }

  const newId = name.toLowerCase().replace(/[^a-z0-9]/g, "")
  const existingCategory = appState.categories.find((c) => c.id === newId && c.id !== categoryId)
  if (existingCategory) {
    showToast("Une catégorie avec ce nom existe déjà", "error")
    return
  }

  if (categoryId) {
    const categoryIndex = appState.categories.findIndex((c) => c.id === categoryId)
    if (categoryIndex !== -1) {
      appState.categories[categoryIndex] = {
        ...appState.categories[categoryIndex],
        name,
        description,
      }
      showToast("Catégorie mise à jour avec succès", "success")
    }
  } else {
    const newCategory = {
      id: newId,
      name,
      description,
      recipeCount: 0,
    }

    appState.categories.push(newCategory)
    showToast("Catégorie créée avec succès", "success")
  }

  loadAdminCategories()
  cancelCategoryForm()
}

function deleteCategory(categoryId) {
  const category = appState.categories.find((c) => c.id === categoryId)
  if (!category) return

  const recipesInCategory = appState.adminRecipes.filter((r) => r.category === categoryId)
  if (recipesInCategory.length > 0) {
    if (
      !confirm(`Cette catégorie contient ${recipesInCategory.length} recette(s). Voulez-vous vraiment la supprimer ?`)
    ) {
      return
    }

    recipesInCategory.forEach((recipe) => {
      recipe.category = "other"
    })
  }

  if (!confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${category.name}" ?`)) {
    return
  }

  const categoryIndex = appState.categories.findIndex((c) => c.id === categoryId)
  if (categoryIndex !== -1) {
    appState.categories.splice(categoryIndex, 1)
    showToast("Catégorie supprimée avec succès", "success")
    loadAdminCategories()
  }
}

function cancelCategoryForm() {
  const container = document.getElementById("categoryFormContainer")
  if (container) {
    container.style.display = "none"
    resetCategoryForm()
  }
}

function resetCategoryForm() {
  const fields = ["categoryName", "categoryDescription"]
  fields.forEach((fieldId) => {
    const field = document.getElementById(fieldId)
    if (field) field.value = ""
  })
}

function loadAdminSubscriptions() {
  const container = document.getElementById("adminSubscriptionsList")
  if (!container) return

  container.innerHTML = appState.subscriptions
    .map((subscription) => {
      const user = appState.users.find((u) => u.id === subscription.userId)
      const isExpired = new Date(subscription.endDate) < new Date()

      return `
            <tr>
                <td>${subscription.id}</td>
                <td>${user ? user.name : "Utilisateur supprimé"}</td>
                <td>
                    <span class="badge badge-${subscription.type === "premium" ? "success" : "secondary"}">
                        ${subscription.type}
                    </span>
                </td>
                <td>${subscription.startDate}</td>
                <td>${subscription.endDate}</td>
                <td>
                    <span class="badge badge-${isExpired ? "danger" : "success"}">
                        ${isExpired ? "Expiré" : "Actif"}
                    </span>
                </td>
                <td>
                    <button class="btn btn-outline btn-sm" onclick="extendSubscription(${subscription.id})" title="Prolonger">
                        <i class="fas fa-calendar-plus"></i>
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="cancelAdminSubscription(${subscription.id})" title="Annuler">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            </tr>
        `
    })
    .join("")
}

function extendSubscription(subscriptionId) {
  const months = prompt("Nombre de mois à ajouter:", "12")
  if (!months || isNaN(months) || months <= 0) return

  const subscriptionIndex = appState.subscriptions.findIndex((s) => s.id === subscriptionId)
  if (subscriptionIndex !== -1) {
    const subscription = appState.subscriptions[subscriptionIndex]
    const currentEndDate = new Date(subscription.endDate)
    const newEndDate = new Date(currentEndDate)
    newEndDate.setMonth(newEndDate.getMonth() + Number.parseInt(months))

    appState.subscriptions[subscriptionIndex].endDate = newEndDate.toISOString().split("T")[0]

    const userIndex = appState.users.findIndex((u) => u.id === subscription.userId)
    if (userIndex !== -1) {
      appState.users[userIndex].expiration = appState.subscriptions[subscriptionIndex].endDate
    }

    showToast(`Abonnement prolongé de ${months} mois`, "success")
    loadAdminSubscriptions()
  }
}

function cancelAdminSubscription(subscriptionId) {
  if (!confirm("Êtes-vous sûr de vouloir annuler cet abonnement ?")) return

  const subscriptionIndex = appState.subscriptions.findIndex((s) => s.id === subscriptionId)
  if (subscriptionIndex !== -1) {
    const subscription = appState.subscriptions[subscriptionIndex]

    const userIndex = appState.users.findIndex((u) => u.id === subscription.userId)
    if (userIndex !== -1) {
      appState.users[userIndex].subscription = "free"
      appState.users[userIndex].expiration = null
    }

    appState.subscriptions.splice(subscriptionIndex, 1)

    showToast("Abonnement annulé", "success")
    loadAdminSubscriptions()
    updateAdminStats()
  }
}

function loadAdminComments() {
  const container = document.getElementById("adminCommentsList")
  if (!container) return

  container.innerHTML = appState.comments
    .map((comment) => {
      const user = appState.users.find((u) => u.id === comment.userId)
      const recipe =
        appState.adminRecipes.find((r) => r.id == comment.recipeId) ||
        appState.allRecipes.find((r) => r.id == comment.recipeId)

      return `
            <tr>
                <td>${comment.id}</td>
                <td>${recipe ? recipe.title : "Recette supprimée"}</td>
                <td>${user ? user.name : "Utilisateur supprimé"}</td>
                <td>
                    <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                        ${comment.text}
                    </div>
                </td>
                <td>${comment.date}</td>
                <td>
                    <button class="btn btn-outline btn-sm" onclick="viewComment(${comment.id})" title="Voir">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="deleteComment(${comment.id})" title="Supprimer">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `
    })
    .join("")
}

function viewComment(commentId) {
  const comment = appState.comments.find((c) => c.id === commentId)
  if (!comment) return

  const user = appState.users.find((u) => u.id === comment.userId)
  const recipe =
    appState.adminRecipes.find((r) => r.id == comment.recipeId) ||
    appState.allRecipes.find((r) => r.id == comment.recipeId)

  alert(
    `Commentaire de ${user ? user.name : "Utilisateur supprimé"}\n` +
      `Recette: ${recipe ? recipe.title : "Recette supprimée"}\n` +
      `Date: ${comment.date}\n\n` +
      `"${comment.text}"`,
  )
}

function deleteComment(commentId) {
  if (!confirm("Êtes-vous sûr de vouloir supprimer ce commentaire ?")) return

  const commentIndex = appState.comments.findIndex((c) => c.id === commentId)
  if (commentIndex !== -1) {
    appState.comments.splice(commentIndex, 1)
    showToast("Commentaire supprimé", "success")
    loadAdminComments()
    updateAdminStats()
  }
}

// =====================
// FONCTIONS UTILITAIRES
// =====================
function setupEventListeners() {
  // Recherche
  const searchInput = document.getElementById("searchInput")
  if (searchInput) {
    searchInput.addEventListener("input", (e) => {
      const query = e.target.value.trim()
      if (query) {
        searchRecipes(query)
      } else {
        filterRecipes(appState.currentFilter)
      }
    })
  }

  // Modal
  const modal = document.getElementById("recipeModal")
  if (modal) {
    modal.addEventListener("click", function (e) {
      if (e.target === this) closeModal()
    })
  }

  // Menu mobile
  const hamburger = document.getElementById("hamburger")
  const navMenu = document.getElementById("navMenu")
  const overlay = document.getElementById("overlay")

  if (hamburger && navMenu && overlay) {
    hamburger.addEventListener("click", () => {
      navMenu.classList.toggle("active")
      overlay.classList.toggle("active")
      hamburger.innerHTML = navMenu.classList.contains("active")
        ? '<i class="fas fa-times"></i>'
        : '<i class="fas fa-bars"></i>'
    })

    overlay.addEventListener("click", () => {
      closeMobileMenu()
    })
  }

  // Thème
  const themeToggle = document.getElementById("themeToggle")
  if (themeToggle) {
    themeToggle.addEventListener("click", toggleDarkMode)
  }

  // Fermeture modal avec Escape
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeModal()
      closeMobileMenu()
    }
  })
}

function closeMobileMenu() {
  const navMenu = document.getElementById("navMenu")
  const overlay = document.getElementById("overlay")
  const hamburger = document.getElementById("hamburger")

  if (navMenu) navMenu.classList.remove("active")
  if (overlay) overlay.classList.remove("active")
  if (hamburger) hamburger.innerHTML = '<i class="fas fa-bars"></i>'
}

function closeModal() {
  const modal = document.getElementById("recipeModal")
  if (modal) {
    modal.classList.remove("active")
  }
}

function toggleDarkMode() {
  appState.darkMode = !appState.darkMode
  document.body.classList.toggle("dark-mode", appState.darkMode)
  localStorage.setItem("darkMode", appState.darkMode)

  const icon = document.querySelector("#themeToggle i")
  if (icon) {
    if (appState.darkMode) {
      icon.classList.replace("fa-moon", "fa-sun")
    } else {
      icon.classList.replace("fa-sun", "fa-moon")
    }
  }
}

function showToast(message, type = "info") {
  const toast = document.createElement("div")
  toast.className = "toast"

  const icons = {
    success: "fas fa-check-circle",
    error: "fas fa-exclamation-circle",
    warning: "fas fa-exclamation-triangle",
    info: "fas fa-info-circle",
  }

  const colors = {
    success: "var(--gradient-secondary)",
    error: "var(--gradient-primary)",
    warning: "var(--gradient-premium)",
    info: "var(--gradient-accent)",
  }

  toast.innerHTML = `
        <i class="${icons[type] || icons.info}"></i>
        <span>${message}</span>
    `

  toast.style.background = colors[type] || colors.info
  document.body.appendChild(toast)

  setTimeout(() => {
    toast.style.animation = "slideInRight 0.3s ease reverse"
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast)
      }
    }, 300)
  }, 3000)
}

function shareRecipe(recipeId) {
  const recipe =
    appState.allRecipes.find((r) => r.id == recipeId) || appState.adminRecipes.find((r) => r.id == recipeId)

  if (!recipe) return

  const shareData = {
    title: `${recipe.title} - RecipeHub`,
    text: `Découvrez cette délicieuse recette: ${recipe.title}`,
    url: window.location.href,
  }

  if (navigator.share) {
    navigator.share(shareData).catch((err) => {
      console.log("Erreur lors du partage:", err)
      fallbackShare(shareData)
    })
  } else {
    fallbackShare(shareData)
  }
}

function fallbackShare(shareData) {
  const text = `${shareData.title}\n${shareData.text}\n${shareData.url}`

  if (navigator.clipboard) {
    navigator.clipboard
      .writeText(text)
      .then(() => {
        showToast("Lien copié dans le presse-papiers", "success")
      })
      .catch(() => {
        showToast("Impossible de copier le lien", "error")
      })
  } else {
    // Fallback pour les navigateurs plus anciens
    const textArea = document.createElement("textarea")
    textArea.value = text
    document.body.appendChild(textArea)
    textArea.select()

    try {
      document.execCommand("copy")
      showToast("Lien copié dans le presse-papiers", "success")
    } catch (err) {
      showToast("Impossible de copier le lien", "error")
    }

    document.body.removeChild(textArea)
  }
}

function createNavLink(link) {
  const li = document.createElement("li")
  li.innerHTML = `
        <a href="#" class="nav-link" onclick="showSection('${link.id}')">
            <i class="${link.icon}"></i> ${link.text}
        </a>
    `
  return li
}

function createUserMenu() {
  const li = document.createElement("li")
  li.className = "user-menu"
  li.innerHTML = `
        <a href="#" class="nav-link">
            <i class="fas fa-user"></i> ${appState.currentUser.name}
            ${appState.currentUser.subscription === "premium" ? '<i class="fas fa-crown" style="color: var(--premium-color); margin-left: 0.5rem;"></i>' : ""}
        </a>
        <ul class="user-dropdown">
            <li><a href="#" onclick="showSection('profile')"><i class="fas fa-user-circle"></i> Mon profil</a></li>
            <li><a href="#" onclick="showSection('subscription')"><i class="fas fa-crown"></i> Mon abonnement</a></li>
            ${
              appState.currentUser.role === "admin"
                ? '<li><a href="#" onclick="showSection(\'admin\')"><i class="fas fa-cog"></i> Administration</a></li>'
                : ""
            }
            <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
        </ul>
    `
  return li
}

function createLoginLink() {
  const li = document.createElement("li")
  li.innerHTML = `
        <a href="#" class="nav-link" onclick="showSection('login')">
            <i class="fas fa-sign-in-alt"></i> Connexion
        </a>
    `
  return li
}

function isValidEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return emailRegex.test(email)
}

function isAdmin() {
  return appState.currentUser?.role === "admin"
}

function hasPremiumAccess() {
  return appState.currentUser?.subscription === "premium"
}

function logActivity(action, description) {
  const activity = {
    id: Date.now(),
    action,
    description,
    userId: appState.currentUser?.id || null,
    timestamp: new Date().toISOString(),
  }

  appState.activityLog.push(activity)

  // Garder seulement les 100 dernières activités
  if (appState.activityLog.length > 100) {
    appState.activityLog = appState.activityLog.slice(-100)
  }

  console.log("📝 Activité:", activity)
}

// =====================
// STYLES CSS ADDITIONNELS
// =====================
const additionalStyles = `
    .badge {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
    }
    
    .badge-info { background: rgba(52, 152, 219, 0.1); color: #3498db; }
    .badge-success { background: rgba(46, 204, 113, 0.1); color: #2ecc71; }
    .badge-warning { background: rgba(243, 156, 18, 0.1); color: #f39c12; }
    .badge-danger { background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
    .badge-secondary { background: rgba(149, 165, 166, 0.1); color: #95a5a6; }
    
    .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.85rem;
    }
    
    .difficulty-facile { background: rgba(46, 204, 113, 0.1); color: var(--success); }
    .difficulty-moyen { background: rgba(243, 156, 18, 0.1); color: var(--warning); }
    .difficulty-difficile { background: rgba(231, 76, 60, 0.1); color: var(--danger); }
    
    .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem;
        gap: 1rem;
    }
    
    .loading p {
        color: var(--gray);
        margin: 0;
    }
    
    .dark-mode .loading p {
        color: #a0a0c0;
    }
`

// Ajouter les styles additionnels
const styleSheet = document.createElement("style")
styleSheet.textContent = additionalStyles
document.head.appendChild(styleSheet)

// =====================
// EXPORT DES FONCTIONS GLOBALES
// =====================
window.showSection = showSection
window.showAdminSection = showAdminSection
window.login = login
window.register = register
window.logout = logout
window.updateProfile = updateProfile
window.toggleFavorite = toggleFavorite
window.filterRecipes = filterRecipes
window.showRecipeDetail = showRecipeDetail
window.closeModal = closeModal
window.addComment = addComment
window.generateMealPlan = generateMealPlan
window.searchSimilarRecipe = searchSimilarRecipe
window.exportMealPlan = exportMealPlan
window.saveMealPlan = saveMealPlan
window.shareMealPlan = shareMealPlan
window.initiatePayment = initiatePayment
window.processPayment = processPayment
window.cancelSubscription = cancelSubscription
window.shareRecipe = shareRecipe
window.loadRecipes = loadRecipes
window.loadFeaturedRecipes = loadFeaturedRecipes
window.showToast = showToast

// Fonctions admin
window.loadAdminUsers = loadAdminUsers
window.showUserForm = showUserForm
window.saveUser = saveUser
window.deleteUser = deleteUser
window.toggleUserStatus = toggleUserStatus
window.cancelUserForm = cancelUserForm
window.loadAdminRecipes = loadAdminRecipes
window.showRecipeForm = showRecipeForm
window.saveRecipe = saveRecipe
window.deleteRecipe = deleteRecipe
window.previewRecipe = previewRecipe
window.cancelRecipeForm = cancelRecipeForm
window.addIngredient = addIngredient
window.removeIngredient = removeIngredient
window.loadAdminCategories = loadAdminCategories
window.showCategoryForm = showCategoryForm
window.saveCategory = saveCategory
window.deleteCategory = deleteCategory
window.cancelCategoryForm = cancelCategoryForm
window.loadAdminSubscriptions = loadAdminSubscriptions
window.extendSubscription = extendSubscription
window.cancelAdminSubscription = cancelAdminSubscription
window.loadAdminComments = loadAdminComments
window.viewComment = viewComment
window.deleteComment = deleteComment

console.log("🎉 RecipeHub JavaScript chargé avec succès !")

</script>
</body>
</html>
